{"ast":null,"code":"import { assign, forEach } from 'min-dash';\nimport { append as svgAppend, attr as svgAttr, classes as svgClasses, clear as svgClear, create as svgCreate } from 'tiny-svg';\nimport { getBBox } from '../../util/Elements';\nvar MARKER_HOVER = 'hover',\n    MARKER_SELECTED = 'selected';\nvar SELECTION_OUTLINE_PADDING = 6;\n/**\n * A plugin that adds a visible selection UI to shapes and connections\n * by appending the <code>hover</code> and <code>selected</code> classes to them.\n *\n * @class\n *\n * Makes elements selectable, too.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n */\n\nexport default function SelectionVisuals(canvas, eventBus, selection) {\n  this._canvas = canvas;\n  var self = this;\n  this._multiSelectionBox = null;\n\n  function addMarker(e, cls) {\n    canvas.addMarker(e, cls);\n  }\n\n  function removeMarker(e, cls) {\n    canvas.removeMarker(e, cls);\n  }\n\n  eventBus.on('element.hover', function (event) {\n    addMarker(event.element, MARKER_HOVER);\n  });\n  eventBus.on('element.out', function (event) {\n    removeMarker(event.element, MARKER_HOVER);\n  });\n  eventBus.on('selection.changed', function (event) {\n    function deselect(s) {\n      removeMarker(s, MARKER_SELECTED);\n    }\n\n    function select(s) {\n      addMarker(s, MARKER_SELECTED);\n    }\n\n    var oldSelection = event.oldSelection,\n        newSelection = event.newSelection;\n    forEach(oldSelection, function (e) {\n      if (newSelection.indexOf(e) === -1) {\n        deselect(e);\n      }\n    });\n    forEach(newSelection, function (e) {\n      if (oldSelection.indexOf(e) === -1) {\n        select(e);\n      }\n    });\n\n    self._updateSelectionOutline(newSelection);\n  });\n  eventBus.on('element.changed', function (event) {\n    if (selection.isSelected(event.element)) {\n      self._updateSelectionOutline(selection.get());\n    }\n  });\n}\nSelectionVisuals.$inject = ['canvas', 'eventBus', 'selection'];\n\nSelectionVisuals.prototype._updateSelectionOutline = function (selection) {\n  var layer = this._canvas.getLayer('selectionOutline');\n\n  svgClear(layer);\n  var enabled = selection.length > 1;\n\n  var container = this._canvas.getContainer();\n\n  svgClasses(container)[enabled ? 'add' : 'remove']('djs-multi-select');\n\n  if (!enabled) {\n    return;\n  }\n\n  var bBox = addSelectionOutlinePadding(getBBox(selection));\n  var rect = svgCreate('rect');\n  svgAttr(rect, assign({\n    rx: 3\n  }, bBox));\n  svgClasses(rect).add('djs-selection-outline');\n  svgAppend(layer, rect);\n}; // helpers //////////\n\n\nfunction addSelectionOutlinePadding(bBox) {\n  return {\n    x: bBox.x - SELECTION_OUTLINE_PADDING,\n    y: bBox.y - SELECTION_OUTLINE_PADDING,\n    width: bBox.width + SELECTION_OUTLINE_PADDING * 2,\n    height: bBox.height + SELECTION_OUTLINE_PADDING * 2\n  };\n}","map":{"version":3,"names":["assign","forEach","append","svgAppend","attr","svgAttr","classes","svgClasses","clear","svgClear","create","svgCreate","getBBox","MARKER_HOVER","MARKER_SELECTED","SELECTION_OUTLINE_PADDING","SelectionVisuals","canvas","eventBus","selection","_canvas","self","_multiSelectionBox","addMarker","e","cls","removeMarker","on","event","element","deselect","s","select","oldSelection","newSelection","indexOf","_updateSelectionOutline","isSelected","get","$inject","prototype","layer","getLayer","enabled","length","container","getContainer","bBox","addSelectionOutlinePadding","rect","rx","add","x","y","width","height"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/selection/SelectionVisuals.js"],"sourcesContent":["import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  clear as svgClear,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport { getBBox } from '../../util/Elements';\n\nvar MARKER_HOVER = 'hover',\n    MARKER_SELECTED = 'selected';\n\nvar SELECTION_OUTLINE_PADDING = 6;\n\n\n/**\n * A plugin that adds a visible selection UI to shapes and connections\n * by appending the <code>hover</code> and <code>selected</code> classes to them.\n *\n * @class\n *\n * Makes elements selectable, too.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n */\nexport default function SelectionVisuals(canvas, eventBus, selection) {\n  this._canvas = canvas;\n\n  var self = this;\n\n  this._multiSelectionBox = null;\n\n  function addMarker(e, cls) {\n    canvas.addMarker(e, cls);\n  }\n\n  function removeMarker(e, cls) {\n    canvas.removeMarker(e, cls);\n  }\n\n  eventBus.on('element.hover', function(event) {\n    addMarker(event.element, MARKER_HOVER);\n  });\n\n  eventBus.on('element.out', function(event) {\n    removeMarker(event.element, MARKER_HOVER);\n  });\n\n  eventBus.on('selection.changed', function(event) {\n\n    function deselect(s) {\n      removeMarker(s, MARKER_SELECTED);\n    }\n\n    function select(s) {\n      addMarker(s, MARKER_SELECTED);\n    }\n\n    var oldSelection = event.oldSelection,\n        newSelection = event.newSelection;\n\n    forEach(oldSelection, function(e) {\n      if (newSelection.indexOf(e) === -1) {\n        deselect(e);\n      }\n    });\n\n    forEach(newSelection, function(e) {\n      if (oldSelection.indexOf(e) === -1) {\n        select(e);\n      }\n    });\n\n    self._updateSelectionOutline(newSelection);\n  });\n\n\n  eventBus.on('element.changed', function(event) {\n    if (selection.isSelected(event.element)) {\n      self._updateSelectionOutline(selection.get());\n    }\n  });\n}\n\nSelectionVisuals.$inject = [\n  'canvas',\n  'eventBus',\n  'selection'\n];\n\nSelectionVisuals.prototype._updateSelectionOutline = function(selection) {\n  var layer = this._canvas.getLayer('selectionOutline');\n\n  svgClear(layer);\n\n  var enabled = selection.length > 1;\n\n  var container = this._canvas.getContainer();\n\n  svgClasses(container)[enabled ? 'add' : 'remove']('djs-multi-select');\n\n  if (!enabled) {\n    return;\n  }\n\n  var bBox = addSelectionOutlinePadding(getBBox(selection));\n\n  var rect = svgCreate('rect');\n\n  svgAttr(rect, assign({\n    rx: 3\n  }, bBox));\n\n  svgClasses(rect).add('djs-selection-outline');\n\n  svgAppend(layer, rect);\n};\n\n// helpers //////////\n\nfunction addSelectionOutlinePadding(bBox) {\n  return {\n    x: bBox.x - SELECTION_OUTLINE_PADDING,\n    y: bBox.y - SELECTION_OUTLINE_PADDING,\n    width: bBox.width + SELECTION_OUTLINE_PADDING * 2,\n    height: bBox.height + SELECTION_OUTLINE_PADDING * 2\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { pointsAligned } from 'diagram-js/lib/util/Geometry';\nimport { assign } from 'min-dash';\nvar HIGH_PRIORITY = 3000;\n/**\n * Snaps connections with Manhattan layout.\n */\n\nexport default function GridSnappingLayoutConnectionBehavior(eventBus, gridSnapping, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  this._gridSnapping = gridSnapping;\n  var self = this;\n  this.postExecuted(['connection.create', 'connection.layout'], HIGH_PRIORITY, function (event) {\n    var context = event.context,\n        connection = context.connection,\n        hints = context.hints || {},\n        waypoints = connection.waypoints;\n\n    if (hints.connectionStart || hints.connectionEnd || hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!hasMiddleSegments(waypoints)) {\n      return;\n    }\n\n    modeling.updateWaypoints(connection, self.snapMiddleSegments(waypoints));\n  });\n}\nGridSnappingLayoutConnectionBehavior.$inject = ['eventBus', 'gridSnapping', 'modeling'];\ninherits(GridSnappingLayoutConnectionBehavior, CommandInterceptor);\n/**\n * Snap middle segments of a given connection.\n *\n * @param {Array<Point>} waypoints\n *\n * @returns {Array<Point>}\n */\n\nGridSnappingLayoutConnectionBehavior.prototype.snapMiddleSegments = function (waypoints) {\n  var gridSnapping = this._gridSnapping,\n      snapped;\n  waypoints = waypoints.slice();\n\n  for (var i = 1; i < waypoints.length - 2; i++) {\n    snapped = snapSegment(gridSnapping, waypoints[i], waypoints[i + 1]);\n    waypoints[i] = snapped[0];\n    waypoints[i + 1] = snapped[1];\n  }\n\n  return waypoints;\n}; // helpers //////////\n\n/**\n * Check whether a connection has a middle segments.\n *\n * @param {Array} waypoints\n *\n * @returns {boolean}\n */\n\n\nfunction hasMiddleSegments(waypoints) {\n  return waypoints.length > 3;\n}\n/**\n * Check whether an alignment is horizontal.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\n\n\nfunction horizontallyAligned(aligned) {\n  return aligned === 'h';\n}\n/**\n * Check whether an alignment is vertical.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\n\n\nfunction verticallyAligned(aligned) {\n  return aligned === 'v';\n}\n/**\n * Get middle segments from a given connection.\n *\n * @param {Array} waypoints\n *\n * @returns {Array}\n */\n\n\nfunction snapSegment(gridSnapping, segmentStart, segmentEnd) {\n  var aligned = pointsAligned(segmentStart, segmentEnd);\n  var snapped = {};\n\n  if (horizontallyAligned(aligned)) {\n    // snap horizontally\n    snapped.y = gridSnapping.snapValue(segmentStart.y);\n  }\n\n  if (verticallyAligned(aligned)) {\n    // snap vertically\n    snapped.x = gridSnapping.snapValue(segmentStart.x);\n  }\n\n  if ('x' in snapped || 'y' in snapped) {\n    segmentStart = assign({}, segmentStart, snapped);\n    segmentEnd = assign({}, segmentEnd, snapped);\n  }\n\n  return [segmentStart, segmentEnd];\n}","map":{"version":3,"names":["inherits","CommandInterceptor","pointsAligned","assign","HIGH_PRIORITY","GridSnappingLayoutConnectionBehavior","eventBus","gridSnapping","modeling","call","_gridSnapping","self","postExecuted","event","context","connection","hints","waypoints","connectionStart","connectionEnd","createElementsBehavior","hasMiddleSegments","updateWaypoints","snapMiddleSegments","$inject","prototype","snapped","slice","i","length","snapSegment","horizontallyAligned","aligned","verticallyAligned","segmentStart","segmentEnd","y","snapValue","x"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingLayoutConnectionBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { pointsAligned } from 'diagram-js/lib/util/Geometry';\n\nimport {\n  assign\n} from 'min-dash';\n\nvar HIGH_PRIORITY = 3000;\n\n\n/**\n * Snaps connections with Manhattan layout.\n */\nexport default function GridSnappingLayoutConnectionBehavior(eventBus, gridSnapping, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._gridSnapping = gridSnapping;\n\n  var self = this;\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        connection = context.connection,\n        hints = context.hints || {},\n        waypoints = connection.waypoints;\n\n    if (hints.connectionStart || hints.connectionEnd || hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!hasMiddleSegments(waypoints)) {\n      return;\n    }\n\n    modeling.updateWaypoints(connection, self.snapMiddleSegments(waypoints));\n  });\n}\n\nGridSnappingLayoutConnectionBehavior.$inject = [\n  'eventBus',\n  'gridSnapping',\n  'modeling'\n];\n\ninherits(GridSnappingLayoutConnectionBehavior, CommandInterceptor);\n\n/**\n * Snap middle segments of a given connection.\n *\n * @param {Array<Point>} waypoints\n *\n * @returns {Array<Point>}\n */\nGridSnappingLayoutConnectionBehavior.prototype.snapMiddleSegments = function(waypoints) {\n  var gridSnapping = this._gridSnapping,\n      snapped;\n\n  waypoints = waypoints.slice();\n\n  for (var i = 1; i < waypoints.length - 2; i++) {\n\n    snapped = snapSegment(gridSnapping, waypoints[i], waypoints[i + 1]);\n\n    waypoints[i] = snapped[0];\n    waypoints[i + 1] = snapped[1];\n  }\n\n  return waypoints;\n};\n\n\n// helpers //////////\n\n/**\n * Check whether a connection has a middle segments.\n *\n * @param {Array} waypoints\n *\n * @returns {boolean}\n */\nfunction hasMiddleSegments(waypoints) {\n  return waypoints.length > 3;\n}\n\n/**\n * Check whether an alignment is horizontal.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\nfunction horizontallyAligned(aligned) {\n  return aligned === 'h';\n}\n\n/**\n * Check whether an alignment is vertical.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\nfunction verticallyAligned(aligned) {\n  return aligned === 'v';\n}\n\n/**\n * Get middle segments from a given connection.\n *\n * @param {Array} waypoints\n *\n * @returns {Array}\n */\nfunction snapSegment(gridSnapping, segmentStart, segmentEnd) {\n\n  var aligned = pointsAligned(segmentStart, segmentEnd);\n\n  var snapped = {};\n\n  if (horizontallyAligned(aligned)) {\n\n    // snap horizontally\n    snapped.y = gridSnapping.snapValue(segmentStart.y);\n  }\n\n  if (verticallyAligned(aligned)) {\n\n    // snap vertically\n    snapped.x = gridSnapping.snapValue(segmentStart.x);\n  }\n\n  if ('x' in snapped || 'y' in snapped) {\n    segmentStart = assign({}, segmentStart, snapped);\n    segmentEnd = assign({}, segmentEnd, snapped);\n  }\n\n  return [ segmentStart, segmentEnd ];\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
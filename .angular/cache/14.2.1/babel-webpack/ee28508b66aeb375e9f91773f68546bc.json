{"ast":null,"code":"import { assign, filter, forEach, isNumber, map, pick, values } from 'min-dash';\nimport { getBBox, getParents } from '../../../util/Elements';\nvar round = Math.round;\nexport default function CreateElementsHandler(modeling) {\n  this._modeling = modeling;\n}\nCreateElementsHandler.$inject = ['modeling'];\n\nCreateElementsHandler.prototype.preExecute = function (context) {\n  var elements = context.elements,\n      parent = context.parent,\n      parentIndex = context.parentIndex,\n      position = context.position,\n      hints = context.hints;\n  var modeling = this._modeling; // make sure each element has x and y\n\n  forEach(elements, function (element) {\n    if (!isNumber(element.x)) {\n      element.x = 0;\n    }\n\n    if (!isNumber(element.y)) {\n      element.y = 0;\n    }\n  });\n  var visibleElements = filter(elements, function (element) {\n    return !element.hidden;\n  });\n  var bbox = getBBox(visibleElements); // center elements around position\n\n  forEach(elements, function (element) {\n    if (isConnection(element)) {\n      element.waypoints = map(element.waypoints, function (waypoint) {\n        return {\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\n        };\n      });\n    }\n\n    assign(element, {\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\n    });\n  });\n  var parents = getParents(elements);\n  var cache = {};\n  forEach(elements, function (element) {\n    if (isConnection(element)) {\n      cache[element.id] = isNumber(parentIndex) ? modeling.createConnection(cache[element.source.id], cache[element.target.id], parentIndex, element, element.parent || parent, hints) : modeling.createConnection(cache[element.source.id], cache[element.target.id], element, element.parent || parent, hints);\n      return;\n    }\n\n    var createShapeHints = assign({}, hints);\n\n    if (parents.indexOf(element) === -1) {\n      createShapeHints.autoResize = false;\n    }\n\n    cache[element.id] = isNumber(parentIndex) ? modeling.createShape(element, pick(element, ['x', 'y', 'width', 'height']), element.parent || parent, parentIndex, createShapeHints) : modeling.createShape(element, pick(element, ['x', 'y', 'width', 'height']), element.parent || parent, createShapeHints);\n  });\n  context.elements = values(cache);\n}; // helpers //////////\n\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}","map":{"version":3,"names":["assign","filter","forEach","isNumber","map","pick","values","getBBox","getParents","round","Math","CreateElementsHandler","modeling","_modeling","$inject","prototype","preExecute","context","elements","parent","parentIndex","position","hints","element","x","y","visibleElements","hidden","bbox","isConnection","waypoints","waypoint","width","height","parents","cache","id","createConnection","source","target","createShapeHints","indexOf","autoResize","createShape"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/modeling/cmd/CreateElementsHandler.js"],"sourcesContent":["import {\r\n  assign,\r\n  filter,\r\n  forEach,\r\n  isNumber,\r\n  map,\r\n  pick,\r\n  values\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getBBox,\r\n  getParents\r\n} from '../../../util/Elements';\r\n\r\nvar round = Math.round;\r\n\r\nexport default function CreateElementsHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nCreateElementsHandler.$inject = [\r\n  'modeling'\r\n];\r\n\r\nCreateElementsHandler.prototype.preExecute = function(context) {\r\n  var elements = context.elements,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex,\r\n      position = context.position,\r\n      hints = context.hints;\r\n\r\n  var modeling = this._modeling;\r\n\r\n  // make sure each element has x and y\r\n  forEach(elements, function(element) {\r\n    if (!isNumber(element.x)) {\r\n      element.x = 0;\r\n    }\r\n\r\n    if (!isNumber(element.y)) {\r\n      element.y = 0;\r\n    }\r\n  });\r\n\r\n  var visibleElements = filter(elements, function(element) {\r\n    return !element.hidden;\r\n  });\r\n\r\n  var bbox = getBBox(visibleElements);\r\n\r\n  // center elements around position\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      element.waypoints = map(element.waypoints, function(waypoint) {\r\n        return {\r\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\r\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\r\n        };\r\n      });\r\n    }\r\n\r\n    assign(element, {\r\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\r\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\r\n    });\r\n  });\r\n\r\n  var parents = getParents(elements);\r\n\r\n  var cache = {};\r\n\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      cache[ element.id ] = isNumber(parentIndex) ?\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          parentIndex,\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        ) :\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        );\r\n\r\n      return;\r\n    }\r\n\r\n    var createShapeHints = assign({}, hints);\r\n\r\n    if (parents.indexOf(element) === -1) {\r\n      createShapeHints.autoResize = false;\r\n    }\r\n\r\n    cache[ element.id ] = isNumber(parentIndex) ?\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        parentIndex,\r\n        createShapeHints\r\n      ) :\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        createShapeHints\r\n      );\r\n  });\r\n\r\n  context.elements = values(cache);\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isConnection(element) {\r\n  return !!element.waypoints;\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
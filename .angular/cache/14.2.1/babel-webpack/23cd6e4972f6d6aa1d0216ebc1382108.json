{"ast":null,"code":"import { isReverse } from './Connect';\nvar HIGH_PRIORITY = 1100,\n    LOW_PRIORITY = 900;\nvar MARKER_OK = 'connect-ok',\n    MARKER_NOT_OK = 'connect-not-ok';\n/**\n * Shows connection preview during connect.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\n\nexport default function ConnectPreview(injector, eventBus, canvas) {\n  var connectionPreview = injector.get('connectionPreview', false);\n  connectionPreview && eventBus.on('connect.move', function (event) {\n    var context = event.context,\n        canConnect = context.canExecute,\n        hover = context.hover,\n        source = context.source,\n        start = context.start,\n        startPosition = context.startPosition,\n        target = context.target,\n        connectionStart = context.connectionStart || startPosition,\n        connectionEnd = context.connectionEnd || {\n      x: event.x,\n      y: event.y\n    },\n        previewStart = connectionStart,\n        previewEnd = connectionEnd;\n\n    if (isReverse(context)) {\n      previewStart = connectionEnd;\n      previewEnd = connectionStart;\n    }\n\n    connectionPreview.drawPreview(context, canConnect, {\n      source: source || start,\n      target: target || hover,\n      connectionStart: previewStart,\n      connectionEnd: previewEnd\n    });\n  });\n  eventBus.on('connect.hover', LOW_PRIORITY, function (event) {\n    var context = event.context,\n        hover = event.hover,\n        canExecute = context.canExecute; // ignore hover\n\n    if (canExecute === null) {\n      return;\n    }\n\n    canvas.addMarker(hover, canExecute ? MARKER_OK : MARKER_NOT_OK);\n  });\n  eventBus.on(['connect.out', 'connect.cleanup'], HIGH_PRIORITY, function (event) {\n    var hover = event.hover;\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_OK);\n      canvas.removeMarker(hover, MARKER_NOT_OK);\n    }\n  });\n  connectionPreview && eventBus.on('connect.cleanup', function (event) {\n    connectionPreview.cleanUp(event.context);\n  });\n}\nConnectPreview.$inject = ['injector', 'eventBus', 'canvas'];","map":{"version":3,"names":["isReverse","HIGH_PRIORITY","LOW_PRIORITY","MARKER_OK","MARKER_NOT_OK","ConnectPreview","injector","eventBus","canvas","connectionPreview","get","on","event","context","canConnect","canExecute","hover","source","start","startPosition","target","connectionStart","connectionEnd","x","y","previewStart","previewEnd","drawPreview","addMarker","removeMarker","cleanUp","$inject"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/connect/ConnectPreview.js"],"sourcesContent":["import { isReverse } from './Connect';\n\nvar HIGH_PRIORITY = 1100,\n    LOW_PRIORITY = 900;\n\nvar MARKER_OK = 'connect-ok',\n    MARKER_NOT_OK = 'connect-not-ok';\n\n/**\n * Shows connection preview during connect.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function ConnectPreview(injector, eventBus, canvas) {\n  var connectionPreview = injector.get('connectionPreview', false);\n\n  connectionPreview && eventBus.on('connect.move', function(event) {\n    var context = event.context,\n        canConnect = context.canExecute,\n        hover = context.hover,\n        source = context.source,\n        start = context.start,\n        startPosition = context.startPosition,\n        target = context.target,\n        connectionStart = context.connectionStart || startPosition,\n        connectionEnd = context.connectionEnd || {\n          x: event.x,\n          y: event.y\n        },\n        previewStart = connectionStart,\n        previewEnd = connectionEnd;\n\n    if (isReverse(context)) {\n      previewStart = connectionEnd;\n      previewEnd = connectionStart;\n    }\n\n    connectionPreview.drawPreview(context, canConnect, {\n      source: source || start,\n      target: target || hover,\n      connectionStart: previewStart,\n      connectionEnd: previewEnd\n    });\n  });\n\n  eventBus.on('connect.hover', LOW_PRIORITY, function(event) {\n    var context = event.context,\n        hover = event.hover,\n        canExecute = context.canExecute;\n\n    // ignore hover\n    if (canExecute === null) {\n      return;\n    }\n\n    canvas.addMarker(hover, canExecute ? MARKER_OK : MARKER_NOT_OK);\n  });\n\n  eventBus.on([\n    'connect.out',\n    'connect.cleanup'\n  ], HIGH_PRIORITY, function(event) {\n    var hover = event.hover;\n\n    if (hover) {\n      canvas.removeMarker(hover, MARKER_OK);\n      canvas.removeMarker(hover, MARKER_NOT_OK);\n    }\n  });\n\n  connectionPreview && eventBus.on('connect.cleanup', function(event) {\n    connectionPreview.cleanUp(event.context);\n  });\n}\n\nConnectPreview.$inject = [\n  'injector',\n  'eventBus',\n  'canvas'\n];\n"],"mappings":"AAAA,SAASA,SAAT,QAA0B,WAA1B;AAEA,IAAIC,aAAa,GAAG,IAApB;AAAA,IACIC,YAAY,GAAG,GADnB;AAGA,IAAIC,SAAS,GAAG,YAAhB;AAAA,IACIC,aAAa,GAAG,gBADpB;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,cAAT,CAAwBC,QAAxB,EAAkCC,QAAlC,EAA4CC,MAA5C,EAAoD;EACjE,IAAIC,iBAAiB,GAAGH,QAAQ,CAACI,GAAT,CAAa,mBAAb,EAAkC,KAAlC,CAAxB;EAEAD,iBAAiB,IAAIF,QAAQ,CAACI,EAAT,CAAY,cAAZ,EAA4B,UAASC,KAAT,EAAgB;IAC/D,IAAIC,OAAO,GAAGD,KAAK,CAACC,OAApB;IAAA,IACIC,UAAU,GAAGD,OAAO,CAACE,UADzB;IAAA,IAEIC,KAAK,GAAGH,OAAO,CAACG,KAFpB;IAAA,IAGIC,MAAM,GAAGJ,OAAO,CAACI,MAHrB;IAAA,IAIIC,KAAK,GAAGL,OAAO,CAACK,KAJpB;IAAA,IAKIC,aAAa,GAAGN,OAAO,CAACM,aAL5B;IAAA,IAMIC,MAAM,GAAGP,OAAO,CAACO,MANrB;IAAA,IAOIC,eAAe,GAAGR,OAAO,CAACQ,eAAR,IAA2BF,aAPjD;IAAA,IAQIG,aAAa,GAAGT,OAAO,CAACS,aAAR,IAAyB;MACvCC,CAAC,EAAEX,KAAK,CAACW,CAD8B;MAEvCC,CAAC,EAAEZ,KAAK,CAACY;IAF8B,CAR7C;IAAA,IAYIC,YAAY,GAAGJ,eAZnB;IAAA,IAaIK,UAAU,GAAGJ,aAbjB;;IAeA,IAAItB,SAAS,CAACa,OAAD,CAAb,EAAwB;MACtBY,YAAY,GAAGH,aAAf;MACAI,UAAU,GAAGL,eAAb;IACD;;IAEDZ,iBAAiB,CAACkB,WAAlB,CAA8Bd,OAA9B,EAAuCC,UAAvC,EAAmD;MACjDG,MAAM,EAAEA,MAAM,IAAIC,KAD+B;MAEjDE,MAAM,EAAEA,MAAM,IAAIJ,KAF+B;MAGjDK,eAAe,EAAEI,YAHgC;MAIjDH,aAAa,EAAEI;IAJkC,CAAnD;EAMD,CA3BoB,CAArB;EA6BAnB,QAAQ,CAACI,EAAT,CAAY,eAAZ,EAA6BT,YAA7B,EAA2C,UAASU,KAAT,EAAgB;IACzD,IAAIC,OAAO,GAAGD,KAAK,CAACC,OAApB;IAAA,IACIG,KAAK,GAAGJ,KAAK,CAACI,KADlB;IAAA,IAEID,UAAU,GAAGF,OAAO,CAACE,UAFzB,CADyD,CAKzD;;IACA,IAAIA,UAAU,KAAK,IAAnB,EAAyB;MACvB;IACD;;IAEDP,MAAM,CAACoB,SAAP,CAAiBZ,KAAjB,EAAwBD,UAAU,GAAGZ,SAAH,GAAeC,aAAjD;EACD,CAXD;EAaAG,QAAQ,CAACI,EAAT,CAAY,CACV,aADU,EAEV,iBAFU,CAAZ,EAGGV,aAHH,EAGkB,UAASW,KAAT,EAAgB;IAChC,IAAII,KAAK,GAAGJ,KAAK,CAACI,KAAlB;;IAEA,IAAIA,KAAJ,EAAW;MACTR,MAAM,CAACqB,YAAP,CAAoBb,KAApB,EAA2Bb,SAA3B;MACAK,MAAM,CAACqB,YAAP,CAAoBb,KAApB,EAA2BZ,aAA3B;IACD;EACF,CAVD;EAYAK,iBAAiB,IAAIF,QAAQ,CAACI,EAAT,CAAY,iBAAZ,EAA+B,UAASC,KAAT,EAAgB;IAClEH,iBAAiB,CAACqB,OAAlB,CAA0BlB,KAAK,CAACC,OAAhC;EACD,CAFoB,CAArB;AAGD;AAEDR,cAAc,CAAC0B,OAAf,GAAyB,CACvB,UADuB,EAEvB,UAFuB,EAGvB,QAHuB,CAAzB"},"metadata":{},"sourceType":"module"}
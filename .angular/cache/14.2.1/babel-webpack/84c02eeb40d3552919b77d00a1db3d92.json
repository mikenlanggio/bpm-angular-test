{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../util/ModelUtil';\nimport { classes, domify } from 'min-dom';\nimport { getPlaneIdFromShape } from '../../util/DrilldownUtil';\nvar LOW_PRIORITY = 250;\nvar ARROW_DOWN_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg>';\nvar EMPTY_MARKER = 'bjs-drilldown-empty';\nexport default function DrilldownOverlayBehavior(canvas, eventBus, elementRegistry, overlays) {\n  CommandInterceptor.call(this, eventBus);\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._overlays = overlays;\n  var self = this;\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function (context) {\n    var shape = context.shape; // Add overlay to the collapsed shape\n\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    } else {\n      self.removeOverlay(shape);\n    }\n  }, true);\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function (context) {\n    var shape = context.shape; // Add overlay to the collapsed shape\n\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    } else {\n      self.removeOverlay(shape);\n    }\n  }, true);\n  this.executed(['shape.create', 'shape.move', 'shape.delete'], LOW_PRIORITY, function (context) {\n    var oldParent = context.oldParent,\n        newParent = context.newParent || context.parent,\n        shape = context.shape; // Add overlay to the collapsed shape\n\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    }\n\n    self.updateDrilldownOverlay(oldParent);\n    self.updateDrilldownOverlay(newParent);\n    self.updateDrilldownOverlay(shape);\n  }, true);\n  this.reverted(['shape.create', 'shape.move', 'shape.delete'], LOW_PRIORITY, function (context) {\n    var oldParent = context.oldParent,\n        newParent = context.newParent || context.parent,\n        shape = context.shape; // Add overlay to the collapsed shape\n\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    }\n\n    self.updateDrilldownOverlay(oldParent);\n    self.updateDrilldownOverlay(newParent);\n    self.updateDrilldownOverlay(shape);\n  }, true);\n  eventBus.on('import.render.complete', function () {\n    elementRegistry.filter(function (e) {\n      return self.canDrillDown(e);\n    }).map(function (el) {\n      self.addOverlay(el);\n    });\n  });\n}\ninherits(DrilldownOverlayBehavior, CommandInterceptor);\n\nDrilldownOverlayBehavior.prototype.updateDrilldownOverlay = function (shape) {\n  var canvas = this._canvas;\n\n  if (!shape) {\n    return;\n  }\n\n  var root = canvas.findRoot(shape);\n\n  if (root) {\n    this.updateOverlayVisibility(root);\n  }\n};\n\nDrilldownOverlayBehavior.prototype.canDrillDown = function (element) {\n  var canvas = this._canvas;\n  return is(element, 'bpmn:SubProcess') && canvas.findRoot(getPlaneIdFromShape(element));\n};\n/**\n * Updates visibility of the drilldown overlay. If the plane has no elements,\n * the drilldown will be only shown when the element is selected.\n *\n * @param {djs.model.Shape|djs.model.Root} element collapsed shape or root element\n */\n\n\nDrilldownOverlayBehavior.prototype.updateOverlayVisibility = function (element) {\n  var overlays = this._overlays;\n  var bo = element.businessObject;\n  var overlay = overlays.get({\n    element: bo.id,\n    type: 'drilldown'\n  })[0];\n\n  if (!overlay) {\n    return;\n  }\n\n  var hasContent = bo && bo.flowElements && bo.flowElements.length;\n  classes(overlay.html).toggle(EMPTY_MARKER, !hasContent);\n};\n/**\n * Attaches a drilldown button to the given element. We assume that the plane has\n * the same id as the element.\n *\n * @param {djs.model.Shape} element collapsed shape\n */\n\n\nDrilldownOverlayBehavior.prototype.addOverlay = function (element) {\n  var canvas = this._canvas;\n  var overlays = this._overlays;\n  var existingOverlays = overlays.get({\n    element: element,\n    type: 'drilldown'\n  });\n\n  if (existingOverlays.length) {\n    this.removeOverlay(element);\n  }\n\n  var button = domify('<button class=\"bjs-drilldown\">' + ARROW_DOWN_SVG + '</button>');\n  button.addEventListener('click', function () {\n    canvas.setRootElement(canvas.findRoot(getPlaneIdFromShape(element)));\n  });\n  overlays.add(element, 'drilldown', {\n    position: {\n      bottom: -7,\n      right: -8\n    },\n    html: button\n  });\n  this.updateOverlayVisibility(element);\n};\n\nDrilldownOverlayBehavior.prototype.removeOverlay = function (element) {\n  var overlays = this._overlays;\n  overlays.remove({\n    element: element,\n    type: 'drilldown'\n  });\n};\n\nDrilldownOverlayBehavior.$inject = ['canvas', 'eventBus', 'elementRegistry', 'overlays'];","map":{"version":3,"names":["inherits","CommandInterceptor","is","classes","domify","getPlaneIdFromShape","LOW_PRIORITY","ARROW_DOWN_SVG","EMPTY_MARKER","DrilldownOverlayBehavior","canvas","eventBus","elementRegistry","overlays","call","_canvas","_eventBus","_elementRegistry","_overlays","self","executed","context","shape","canDrillDown","addOverlay","removeOverlay","reverted","oldParent","newParent","parent","updateDrilldownOverlay","on","filter","e","map","el","prototype","root","findRoot","updateOverlayVisibility","element","bo","businessObject","overlay","get","id","type","hasContent","flowElements","length","html","toggle","existingOverlays","button","addEventListener","setRootElement","add","position","bottom","right","remove","$inject"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/drilldown/DrilldownOverlayBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../util/ModelUtil';\nimport { classes, domify } from 'min-dom';\nimport { getPlaneIdFromShape } from '../../util/DrilldownUtil';\n\nvar LOW_PRIORITY = 250;\nvar ARROW_DOWN_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg>';\n\nvar EMPTY_MARKER = 'bjs-drilldown-empty';\n\nexport default function DrilldownOverlayBehavior(\n    canvas, eventBus, elementRegistry, overlays\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._overlays = overlays;\n\n  var self = this;\n\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    } else {\n      self.removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self.canDrillDown(shape)) {\n      self.addOverlay(shape);\n    } else {\n      self.removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.executed([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self.canDrillDown(shape)) {\n        self.addOverlay(shape);\n      }\n\n      self.updateDrilldownOverlay(oldParent);\n      self.updateDrilldownOverlay(newParent);\n      self.updateDrilldownOverlay(shape);\n    }, true);\n\n\n  this.reverted([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self.canDrillDown(shape)) {\n        self.addOverlay(shape);\n      }\n\n      self.updateDrilldownOverlay(oldParent);\n      self.updateDrilldownOverlay(newParent);\n      self.updateDrilldownOverlay(shape);\n    }, true);\n\n\n  eventBus.on('import.render.complete', function() {\n    elementRegistry.filter(function(e) {\n      return self.canDrillDown(e);\n    }).map(function(el) {\n      self.addOverlay(el);\n    });\n  });\n\n}\n\ninherits(DrilldownOverlayBehavior, CommandInterceptor);\n\nDrilldownOverlayBehavior.prototype.updateDrilldownOverlay = function(shape) {\n  var canvas = this._canvas;\n\n  if (!shape) {\n    return;\n  }\n\n  var root = canvas.findRoot(shape);\n  if (root) {\n    this.updateOverlayVisibility(root);\n  }\n};\n\n\nDrilldownOverlayBehavior.prototype.canDrillDown = function(element) {\n  var canvas = this._canvas;\n  return is(element, 'bpmn:SubProcess') && canvas.findRoot(getPlaneIdFromShape(element));\n};\n\n/**\n * Updates visibility of the drilldown overlay. If the plane has no elements,\n * the drilldown will be only shown when the element is selected.\n *\n * @param {djs.model.Shape|djs.model.Root} element collapsed shape or root element\n */\nDrilldownOverlayBehavior.prototype.updateOverlayVisibility = function(element) {\n  var overlays = this._overlays;\n\n  var bo = element.businessObject;\n\n  var overlay = overlays.get({ element: bo.id, type: 'drilldown' })[0];\n\n  if (!overlay) {\n    return;\n  }\n\n  var hasContent = bo && bo.flowElements && bo.flowElements.length;\n  classes(overlay.html).toggle(EMPTY_MARKER, !hasContent);\n};\n\n/**\n * Attaches a drilldown button to the given element. We assume that the plane has\n * the same id as the element.\n *\n * @param {djs.model.Shape} element collapsed shape\n */\nDrilldownOverlayBehavior.prototype.addOverlay = function(element) {\n  var canvas = this._canvas;\n  var overlays = this._overlays;\n\n  var existingOverlays = overlays.get({ element: element, type: 'drilldown' });\n  if (existingOverlays.length) {\n    this.removeOverlay(element);\n  }\n\n  var button = domify('<button class=\"bjs-drilldown\">' + ARROW_DOWN_SVG + '</button>');\n\n  button.addEventListener('click', function() {\n    canvas.setRootElement(canvas.findRoot(getPlaneIdFromShape(element)));\n  });\n\n  overlays.add(element, 'drilldown', {\n    position: {\n      bottom: -7,\n      right: -8\n    },\n    html: button\n  });\n\n  this.updateOverlayVisibility(element);\n};\n\nDrilldownOverlayBehavior.prototype.removeOverlay = function(element) {\n  var overlays = this._overlays;\n\n  overlays.remove({\n    element: element,\n    type: 'drilldown'\n  });\n};\n\nDrilldownOverlayBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'elementRegistry',\n  'overlays'\n];"],"mappings":"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"},"metadata":{},"sourceType":"module"}
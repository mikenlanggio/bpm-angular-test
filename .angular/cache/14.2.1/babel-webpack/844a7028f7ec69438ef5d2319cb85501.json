{"ast":null,"code":"import { forEach } from 'min-dash';\nimport { event as domEvent, query as domQuery, queryAll as domQueryAll } from 'min-dom';\nimport { BENDPOINT_CLS, SEGMENT_DRAGGER_CLS, addBendpoint, addSegmentDragger, calculateSegmentMoveRegion, getConnectionIntersection } from './BendpointUtil';\nimport { escapeCSS } from '../../util/EscapeUtil';\nimport { pointsAligned, getMidPoint } from '../../util/Geometry';\nimport { isPrimaryButton } from '../../util/Mouse';\nimport { append as svgAppend, attr as svgAttr, classes as svgClasses, create as svgCreate, remove as svgRemove } from 'tiny-svg';\nimport { translate } from '../../util/SvgTransformUtil';\n/**\n * A service that adds editable bendpoints to connections.\n */\n\nexport default function Bendpoints(eventBus, canvas, interactionEvents, bendpointMove, connectionSegmentMove) {\n  /**\n   * Returns true if intersection point is inside middle region of segment, adjusted by\n   * optional threshold\n   */\n  function isIntersectionMiddle(intersection, waypoints, treshold) {\n    var idx = intersection.index,\n        p = intersection.point,\n        p0,\n        p1,\n        mid,\n        aligned,\n        xDelta,\n        yDelta;\n\n    if (idx <= 0 || intersection.bendpoint) {\n      return false;\n    }\n\n    p0 = waypoints[idx - 1];\n    p1 = waypoints[idx];\n    mid = getMidPoint(p0, p1), aligned = pointsAligned(p0, p1);\n    xDelta = Math.abs(p.x - mid.x);\n    yDelta = Math.abs(p.y - mid.y);\n    return aligned && xDelta <= treshold && yDelta <= treshold;\n  }\n  /**\n   * Calculates the threshold from a connection's middle which fits the two-third-region\n   */\n\n\n  function calculateIntersectionThreshold(connection, intersection) {\n    var waypoints = connection.waypoints,\n        relevantSegment,\n        alignment,\n        segmentLength,\n        threshold;\n\n    if (intersection.index <= 0 || intersection.bendpoint) {\n      return null;\n    } // segment relative to connection intersection\n\n\n    relevantSegment = {\n      start: waypoints[intersection.index - 1],\n      end: waypoints[intersection.index]\n    };\n    alignment = pointsAligned(relevantSegment.start, relevantSegment.end);\n\n    if (!alignment) {\n      return null;\n    }\n\n    if (alignment === 'h') {\n      segmentLength = relevantSegment.end.x - relevantSegment.start.x;\n    } else {\n      segmentLength = relevantSegment.end.y - relevantSegment.start.y;\n    } // calculate threshold relative to 2/3 of segment length\n\n\n    threshold = calculateSegmentMoveRegion(segmentLength) / 2;\n    return threshold;\n  }\n\n  function activateBendpointMove(event, connection) {\n    var waypoints = connection.waypoints,\n        intersection = getConnectionIntersection(canvas, waypoints, event),\n        threshold;\n\n    if (!intersection) {\n      return;\n    }\n\n    threshold = calculateIntersectionThreshold(connection, intersection);\n\n    if (isIntersectionMiddle(intersection, waypoints, threshold)) {\n      connectionSegmentMove.start(event, connection, intersection.index);\n    } else {\n      bendpointMove.start(event, connection, intersection.index, !intersection.bendpoint);\n    } // we've handled the event\n\n\n    return true;\n  }\n\n  function bindInteractionEvents(node, eventName, element) {\n    domEvent.bind(node, eventName, function (event) {\n      interactionEvents.triggerMouseEvent(eventName, event, element);\n      event.stopPropagation();\n    });\n  }\n\n  function getBendpointsContainer(element, create) {\n    var layer = canvas.getLayer('overlays'),\n        gfx = domQuery('.djs-bendpoints[data-element-id=\"' + escapeCSS(element.id) + '\"]', layer);\n\n    if (!gfx && create) {\n      gfx = svgCreate('g');\n      svgAttr(gfx, {\n        'data-element-id': element.id\n      });\n      svgClasses(gfx).add('djs-bendpoints');\n      svgAppend(layer, gfx);\n      bindInteractionEvents(gfx, 'mousedown', element);\n      bindInteractionEvents(gfx, 'click', element);\n      bindInteractionEvents(gfx, 'dblclick', element);\n    }\n\n    return gfx;\n  }\n\n  function getSegmentDragger(idx, parentGfx) {\n    return domQuery('.djs-segment-dragger[data-segment-idx=\"' + idx + '\"]', parentGfx);\n  }\n\n  function createBendpoints(gfx, connection) {\n    connection.waypoints.forEach(function (p, idx) {\n      var bendpoint = addBendpoint(gfx);\n      svgAppend(gfx, bendpoint);\n      translate(bendpoint, p.x, p.y);\n    }); // add floating bendpoint\n\n    addBendpoint(gfx, 'floating');\n  }\n\n  function createSegmentDraggers(gfx, connection) {\n    var waypoints = connection.waypoints;\n    var segmentStart, segmentEnd, segmentDraggerGfx;\n\n    for (var i = 1; i < waypoints.length; i++) {\n      segmentStart = waypoints[i - 1];\n      segmentEnd = waypoints[i];\n\n      if (pointsAligned(segmentStart, segmentEnd)) {\n        segmentDraggerGfx = addSegmentDragger(gfx, segmentStart, segmentEnd);\n        svgAttr(segmentDraggerGfx, {\n          'data-segment-idx': i\n        });\n        bindInteractionEvents(segmentDraggerGfx, 'mousemove', connection);\n      }\n    }\n  }\n\n  function clearBendpoints(gfx) {\n    forEach(domQueryAll('.' + BENDPOINT_CLS, gfx), function (node) {\n      svgRemove(node);\n    });\n  }\n\n  function clearSegmentDraggers(gfx) {\n    forEach(domQueryAll('.' + SEGMENT_DRAGGER_CLS, gfx), function (node) {\n      svgRemove(node);\n    });\n  }\n\n  function addHandles(connection) {\n    var gfx = getBendpointsContainer(connection);\n\n    if (!gfx) {\n      gfx = getBendpointsContainer(connection, true);\n      createBendpoints(gfx, connection);\n      createSegmentDraggers(gfx, connection);\n    }\n\n    return gfx;\n  }\n\n  function updateHandles(connection) {\n    var gfx = getBendpointsContainer(connection);\n\n    if (gfx) {\n      clearSegmentDraggers(gfx);\n      clearBendpoints(gfx);\n      createSegmentDraggers(gfx, connection);\n      createBendpoints(gfx, connection);\n    }\n  }\n\n  function updateFloatingBendpointPosition(parentGfx, intersection) {\n    var floating = domQuery('.floating', parentGfx),\n        point = intersection.point;\n\n    if (!floating) {\n      return;\n    }\n\n    translate(floating, point.x, point.y);\n  }\n\n  function updateSegmentDraggerPosition(parentGfx, intersection, waypoints) {\n    var draggerGfx = getSegmentDragger(intersection.index, parentGfx),\n        segmentStart = waypoints[intersection.index - 1],\n        segmentEnd = waypoints[intersection.index],\n        point = intersection.point,\n        mid = getMidPoint(segmentStart, segmentEnd),\n        alignment = pointsAligned(segmentStart, segmentEnd),\n        draggerVisual,\n        relativePosition;\n\n    if (!draggerGfx) {\n      return;\n    }\n\n    draggerVisual = getDraggerVisual(draggerGfx);\n    relativePosition = {\n      x: point.x - mid.x,\n      y: point.y - mid.y\n    };\n\n    if (alignment === 'v') {\n      // rotate position\n      relativePosition = {\n        x: relativePosition.y,\n        y: relativePosition.x\n      };\n    }\n\n    translate(draggerVisual, relativePosition.x, relativePosition.y);\n  }\n\n  eventBus.on('connection.changed', function (event) {\n    updateHandles(event.element);\n  });\n  eventBus.on('connection.remove', function (event) {\n    var gfx = getBendpointsContainer(event.element);\n\n    if (gfx) {\n      svgRemove(gfx);\n    }\n  });\n  eventBus.on('element.marker.update', function (event) {\n    var element = event.element,\n        bendpointsGfx;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    bendpointsGfx = addHandles(element);\n\n    if (event.add) {\n      svgClasses(bendpointsGfx).add(event.marker);\n    } else {\n      svgClasses(bendpointsGfx).remove(event.marker);\n    }\n  });\n  eventBus.on('element.mousemove', function (event) {\n    var element = event.element,\n        waypoints = element.waypoints,\n        bendpointsGfx,\n        intersection;\n\n    if (waypoints) {\n      bendpointsGfx = getBendpointsContainer(element, true);\n      intersection = getConnectionIntersection(canvas, waypoints, event.originalEvent);\n\n      if (!intersection) {\n        return;\n      }\n\n      updateFloatingBendpointPosition(bendpointsGfx, intersection);\n\n      if (!intersection.bendpoint) {\n        updateSegmentDraggerPosition(bendpointsGfx, intersection, waypoints);\n      }\n    }\n  });\n  eventBus.on('element.mousedown', function (event) {\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var originalEvent = event.originalEvent,\n        element = event.element;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    return activateBendpointMove(originalEvent, element);\n  });\n  eventBus.on('selection.changed', function (event) {\n    var newSelection = event.newSelection,\n        primary = newSelection[0];\n\n    if (primary && primary.waypoints) {\n      addHandles(primary);\n    }\n  });\n  eventBus.on('element.hover', function (event) {\n    var element = event.element;\n\n    if (element.waypoints) {\n      addHandles(element);\n      interactionEvents.registerEvent(event.gfx, 'mousemove', 'element.mousemove');\n    }\n  });\n  eventBus.on('element.out', function (event) {\n    interactionEvents.unregisterEvent(event.gfx, 'mousemove', 'element.mousemove');\n  }); // update bendpoint container data attribute on element ID change\n\n  eventBus.on('element.updateId', function (context) {\n    var element = context.element,\n        newId = context.newId;\n\n    if (element.waypoints) {\n      var bendpointContainer = getBendpointsContainer(element);\n\n      if (bendpointContainer) {\n        svgAttr(bendpointContainer, {\n          'data-element-id': newId\n        });\n      }\n    }\n  }); // API\n\n  this.addHandles = addHandles;\n  this.updateHandles = updateHandles;\n  this.getBendpointsContainer = getBendpointsContainer;\n  this.getSegmentDragger = getSegmentDragger;\n}\nBendpoints.$inject = ['eventBus', 'canvas', 'interactionEvents', 'bendpointMove', 'connectionSegmentMove']; // helper /////////////\n\nfunction getDraggerVisual(draggerGfx) {\n  return domQuery('.djs-visual', draggerGfx);\n}","map":{"version":3,"names":["forEach","event","domEvent","query","domQuery","queryAll","domQueryAll","BENDPOINT_CLS","SEGMENT_DRAGGER_CLS","addBendpoint","addSegmentDragger","calculateSegmentMoveRegion","getConnectionIntersection","escapeCSS","pointsAligned","getMidPoint","isPrimaryButton","append","svgAppend","attr","svgAttr","classes","svgClasses","create","svgCreate","remove","svgRemove","translate","Bendpoints","eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove","isIntersectionMiddle","intersection","waypoints","treshold","idx","index","p","point","p0","p1","mid","aligned","xDelta","yDelta","bendpoint","Math","abs","x","y","calculateIntersectionThreshold","connection","relevantSegment","alignment","segmentLength","threshold","start","end","activateBendpointMove","bindInteractionEvents","node","eventName","element","bind","triggerMouseEvent","stopPropagation","getBendpointsContainer","layer","getLayer","gfx","id","add","getSegmentDragger","parentGfx","createBendpoints","createSegmentDraggers","segmentStart","segmentEnd","segmentDraggerGfx","i","length","clearBendpoints","clearSegmentDraggers","addHandles","updateHandles","updateFloatingBendpointPosition","floating","updateSegmentDraggerPosition","draggerGfx","draggerVisual","relativePosition","getDraggerVisual","on","bendpointsGfx","marker","originalEvent","newSelection","primary","registerEvent","unregisterEvent","context","newId","bendpointContainer","$inject"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/bendpoints/Bendpoints.js"],"sourcesContent":["import { forEach } from 'min-dash';\n\nimport {\n  event as domEvent,\n  query as domQuery,\n  queryAll as domQueryAll\n} from 'min-dom';\n\nimport {\n  BENDPOINT_CLS,\n  SEGMENT_DRAGGER_CLS,\n  addBendpoint,\n  addSegmentDragger,\n  calculateSegmentMoveRegion,\n  getConnectionIntersection\n} from './BendpointUtil';\n\nimport {\n  escapeCSS\n} from '../../util/EscapeUtil';\n\nimport {\n  pointsAligned,\n  getMidPoint\n} from '../../util/Geometry';\n\nimport {\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  translate\n} from '../../util/SvgTransformUtil';\n\n\n/**\n * A service that adds editable bendpoints to connections.\n */\nexport default function Bendpoints(\n    eventBus, canvas, interactionEvents,\n    bendpointMove, connectionSegmentMove) {\n\n  /**\n   * Returns true if intersection point is inside middle region of segment, adjusted by\n   * optional threshold\n   */\n  function isIntersectionMiddle(intersection, waypoints, treshold) {\n    var idx = intersection.index,\n        p = intersection.point,\n        p0, p1, mid, aligned, xDelta, yDelta;\n\n    if (idx <= 0 || intersection.bendpoint) {\n      return false;\n    }\n\n    p0 = waypoints[idx - 1];\n    p1 = waypoints[idx];\n    mid = getMidPoint(p0, p1),\n    aligned = pointsAligned(p0, p1);\n    xDelta = Math.abs(p.x - mid.x);\n    yDelta = Math.abs(p.y - mid.y);\n\n    return aligned && xDelta <= treshold && yDelta <= treshold;\n  }\n\n  /**\n   * Calculates the threshold from a connection's middle which fits the two-third-region\n   */\n  function calculateIntersectionThreshold(connection, intersection) {\n    var waypoints = connection.waypoints,\n        relevantSegment, alignment, segmentLength, threshold;\n\n    if (intersection.index <= 0 || intersection.bendpoint) {\n      return null;\n    }\n\n    // segment relative to connection intersection\n    relevantSegment = {\n      start: waypoints[intersection.index - 1],\n      end: waypoints[intersection.index]\n    };\n\n    alignment = pointsAligned(relevantSegment.start, relevantSegment.end);\n\n    if (!alignment) {\n      return null;\n    }\n\n    if (alignment === 'h') {\n      segmentLength = relevantSegment.end.x - relevantSegment.start.x;\n    } else {\n      segmentLength = relevantSegment.end.y - relevantSegment.start.y;\n    }\n\n    // calculate threshold relative to 2/3 of segment length\n    threshold = calculateSegmentMoveRegion(segmentLength) / 2;\n\n    return threshold;\n  }\n\n  function activateBendpointMove(event, connection) {\n    var waypoints = connection.waypoints,\n        intersection = getConnectionIntersection(canvas, waypoints, event),\n        threshold;\n\n    if (!intersection) {\n      return;\n    }\n\n    threshold = calculateIntersectionThreshold(connection, intersection);\n\n    if (isIntersectionMiddle(intersection, waypoints, threshold)) {\n      connectionSegmentMove.start(event, connection, intersection.index);\n    } else {\n      bendpointMove.start(event, connection, intersection.index, !intersection.bendpoint);\n    }\n\n    // we've handled the event\n    return true;\n  }\n\n  function bindInteractionEvents(node, eventName, element) {\n\n    domEvent.bind(node, eventName, function(event) {\n      interactionEvents.triggerMouseEvent(eventName, event, element);\n      event.stopPropagation();\n    });\n  }\n\n  function getBendpointsContainer(element, create) {\n\n    var layer = canvas.getLayer('overlays'),\n        gfx = domQuery('.djs-bendpoints[data-element-id=\"' + escapeCSS(element.id) + '\"]', layer);\n\n    if (!gfx && create) {\n      gfx = svgCreate('g');\n      svgAttr(gfx, { 'data-element-id': element.id });\n      svgClasses(gfx).add('djs-bendpoints');\n\n      svgAppend(layer, gfx);\n\n      bindInteractionEvents(gfx, 'mousedown', element);\n      bindInteractionEvents(gfx, 'click', element);\n      bindInteractionEvents(gfx, 'dblclick', element);\n    }\n\n    return gfx;\n  }\n\n  function getSegmentDragger(idx, parentGfx) {\n    return domQuery(\n      '.djs-segment-dragger[data-segment-idx=\"' + idx + '\"]',\n      parentGfx\n    );\n  }\n\n  function createBendpoints(gfx, connection) {\n    connection.waypoints.forEach(function(p, idx) {\n      var bendpoint = addBendpoint(gfx);\n\n      svgAppend(gfx, bendpoint);\n\n      translate(bendpoint, p.x, p.y);\n    });\n\n    // add floating bendpoint\n    addBendpoint(gfx, 'floating');\n  }\n\n  function createSegmentDraggers(gfx, connection) {\n\n    var waypoints = connection.waypoints;\n\n    var segmentStart,\n        segmentEnd,\n        segmentDraggerGfx;\n\n    for (var i = 1; i < waypoints.length; i++) {\n\n      segmentStart = waypoints[i - 1];\n      segmentEnd = waypoints[i];\n\n      if (pointsAligned(segmentStart, segmentEnd)) {\n        segmentDraggerGfx = addSegmentDragger(gfx, segmentStart, segmentEnd);\n\n        svgAttr(segmentDraggerGfx, { 'data-segment-idx': i });\n\n        bindInteractionEvents(segmentDraggerGfx, 'mousemove', connection);\n      }\n    }\n  }\n\n  function clearBendpoints(gfx) {\n    forEach(domQueryAll('.' + BENDPOINT_CLS, gfx), function(node) {\n      svgRemove(node);\n    });\n  }\n\n  function clearSegmentDraggers(gfx) {\n    forEach(domQueryAll('.' + SEGMENT_DRAGGER_CLS, gfx), function(node) {\n      svgRemove(node);\n    });\n  }\n\n  function addHandles(connection) {\n\n    var gfx = getBendpointsContainer(connection);\n\n    if (!gfx) {\n      gfx = getBendpointsContainer(connection, true);\n\n      createBendpoints(gfx, connection);\n      createSegmentDraggers(gfx, connection);\n    }\n\n    return gfx;\n  }\n\n  function updateHandles(connection) {\n\n    var gfx = getBendpointsContainer(connection);\n\n    if (gfx) {\n      clearSegmentDraggers(gfx);\n      clearBendpoints(gfx);\n      createSegmentDraggers(gfx, connection);\n      createBendpoints(gfx, connection);\n    }\n  }\n\n  function updateFloatingBendpointPosition(parentGfx, intersection) {\n    var floating = domQuery('.floating', parentGfx),\n        point = intersection.point;\n\n    if (!floating) {\n      return;\n    }\n\n    translate(floating, point.x, point.y);\n\n  }\n\n  function updateSegmentDraggerPosition(parentGfx, intersection, waypoints) {\n\n    var draggerGfx = getSegmentDragger(intersection.index, parentGfx),\n        segmentStart = waypoints[intersection.index - 1],\n        segmentEnd = waypoints[intersection.index],\n        point = intersection.point,\n        mid = getMidPoint(segmentStart, segmentEnd),\n        alignment = pointsAligned(segmentStart, segmentEnd),\n        draggerVisual, relativePosition;\n\n    if (!draggerGfx) {\n      return;\n    }\n\n    draggerVisual = getDraggerVisual(draggerGfx);\n\n    relativePosition = {\n      x: point.x - mid.x,\n      y: point.y - mid.y\n    };\n\n    if (alignment === 'v') {\n\n      // rotate position\n      relativePosition = {\n        x: relativePosition.y,\n        y: relativePosition.x\n      };\n    }\n\n    translate(draggerVisual, relativePosition.x, relativePosition.y);\n  }\n\n  eventBus.on('connection.changed', function(event) {\n    updateHandles(event.element);\n  });\n\n  eventBus.on('connection.remove', function(event) {\n    var gfx = getBendpointsContainer(event.element);\n\n    if (gfx) {\n      svgRemove(gfx);\n    }\n  });\n\n  eventBus.on('element.marker.update', function(event) {\n\n    var element = event.element,\n        bendpointsGfx;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    bendpointsGfx = addHandles(element);\n\n    if (event.add) {\n      svgClasses(bendpointsGfx).add(event.marker);\n    } else {\n      svgClasses(bendpointsGfx).remove(event.marker);\n    }\n  });\n\n  eventBus.on('element.mousemove', function(event) {\n\n    var element = event.element,\n        waypoints = element.waypoints,\n        bendpointsGfx,\n        intersection;\n\n    if (waypoints) {\n      bendpointsGfx = getBendpointsContainer(element, true);\n\n      intersection = getConnectionIntersection(canvas, waypoints, event.originalEvent);\n\n      if (!intersection) {\n        return;\n      }\n\n      updateFloatingBendpointPosition(bendpointsGfx, intersection);\n\n      if (!intersection.bendpoint) {\n        updateSegmentDraggerPosition(bendpointsGfx, intersection, waypoints);\n      }\n\n    }\n  });\n\n  eventBus.on('element.mousedown', function(event) {\n\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var originalEvent = event.originalEvent,\n        element = event.element;\n\n    if (!element.waypoints) {\n      return;\n    }\n\n    return activateBendpointMove(originalEvent, element);\n  });\n\n  eventBus.on('selection.changed', function(event) {\n    var newSelection = event.newSelection,\n        primary = newSelection[0];\n\n    if (primary && primary.waypoints) {\n      addHandles(primary);\n    }\n  });\n\n  eventBus.on('element.hover', function(event) {\n    var element = event.element;\n\n    if (element.waypoints) {\n      addHandles(element);\n      interactionEvents.registerEvent(event.gfx, 'mousemove', 'element.mousemove');\n    }\n  });\n\n  eventBus.on('element.out', function(event) {\n    interactionEvents.unregisterEvent(event.gfx, 'mousemove', 'element.mousemove');\n  });\n\n  // update bendpoint container data attribute on element ID change\n  eventBus.on('element.updateId', function(context) {\n    var element = context.element,\n        newId = context.newId;\n\n    if (element.waypoints) {\n      var bendpointContainer = getBendpointsContainer(element);\n\n      if (bendpointContainer) {\n        svgAttr(bendpointContainer, { 'data-element-id': newId });\n      }\n    }\n  });\n\n  // API\n\n  this.addHandles = addHandles;\n  this.updateHandles = updateHandles;\n  this.getBendpointsContainer = getBendpointsContainer;\n  this.getSegmentDragger = getSegmentDragger;\n}\n\nBendpoints.$inject = [\n  'eventBus',\n  'canvas',\n  'interactionEvents',\n  'bendpointMove',\n  'connectionSegmentMove'\n];\n\n\n\n// helper /////////////\n\nfunction getDraggerVisual(draggerGfx) {\n  return domQuery('.djs-visual', draggerGfx);\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
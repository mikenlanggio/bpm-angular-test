{"ast":null,"code":"import { filter } from 'min-dash';\nimport { eachElement } from 'diagram-js/lib/util/Elements';\nimport { getLanesRoot, getChildLanes, LANE_INDENTATION } from '../util/LaneUtil';\n/**\n * A handler that allows us to add a new lane\n * above or below an existing one.\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\n\nexport default function AddLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\nAddLaneHandler.$inject = ['modeling', 'spaceTool'];\n\nAddLaneHandler.prototype.preExecute = function (context) {\n  var spaceTool = this._spaceTool,\n      modeling = this._modeling;\n  var shape = context.shape,\n      location = context.location;\n  var lanesRoot = getLanesRoot(shape);\n  var isRoot = lanesRoot === shape,\n      laneParent = isRoot ? shape : shape.parent;\n  var existingChildLanes = getChildLanes(laneParent); // (0) add a lane if we currently got none and are adding to root\n\n  if (!existingChildLanes.length) {\n    modeling.createShape({\n      type: 'bpmn:Lane'\n    }, {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y,\n      width: shape.width - LANE_INDENTATION,\n      height: shape.height\n    }, laneParent);\n  } // (1) collect affected elements to create necessary space\n\n\n  var allAffected = [];\n  eachElement(lanesRoot, function (element) {\n    allAffected.push(element); // handle element labels in the diagram root\n\n    if (element.label) {\n      allAffected.push(element.label);\n    }\n\n    if (element === shape) {\n      return [];\n    }\n\n    return filter(element.children, function (c) {\n      return c !== shape;\n    });\n  });\n  var offset = location === 'top' ? -120 : 120,\n      lanePosition = location === 'top' ? shape.y : shape.y + shape.height,\n      spacePos = lanePosition + (location === 'top' ? 10 : -10),\n      direction = location === 'top' ? 'n' : 's';\n  var adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n  spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, {\n    x: 0,\n    y: offset\n  }, direction, spacePos); // (2) create new lane at open space\n\n  context.newLane = modeling.createShape({\n    type: 'bpmn:Lane'\n  }, {\n    x: shape.x + (isRoot ? LANE_INDENTATION : 0),\n    y: lanePosition - (location === 'top' ? 120 : 0),\n    width: shape.width - (isRoot ? LANE_INDENTATION : 0),\n    height: 120\n  }, laneParent);\n};","map":{"version":3,"names":["filter","eachElement","getLanesRoot","getChildLanes","LANE_INDENTATION","AddLaneHandler","modeling","spaceTool","_modeling","_spaceTool","$inject","prototype","preExecute","context","shape","location","lanesRoot","isRoot","laneParent","parent","existingChildLanes","length","createShape","type","x","y","width","height","allAffected","element","push","label","children","c","offset","lanePosition","spacePos","direction","adjustments","calculateAdjustments","makeSpace","movingShapes","resizingShapes","newLane"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/modeling/cmd/AddLaneHandler.js"],"sourcesContent":["import {\n  filter\n} from 'min-dash';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  getLanesRoot,\n  getChildLanes,\n  LANE_INDENTATION\n} from '../util/LaneUtil';\n\n\n/**\n * A handler that allows us to add a new lane\n * above or below an existing one.\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function AddLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nAddLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nAddLaneHandler.prototype.preExecute = function(context) {\n\n  var spaceTool = this._spaceTool,\n      modeling = this._modeling;\n\n  var shape = context.shape,\n      location = context.location;\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var isRoot = lanesRoot === shape,\n      laneParent = isRoot ? shape : shape.parent;\n\n  var existingChildLanes = getChildLanes(laneParent);\n\n  // (0) add a lane if we currently got none and are adding to root\n  if (!existingChildLanes.length) {\n    modeling.createShape({ type: 'bpmn:Lane' }, {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y,\n      width: shape.width - LANE_INDENTATION,\n      height: shape.height\n    }, laneParent);\n  }\n\n  // (1) collect affected elements to create necessary space\n  var allAffected = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    // handle element labels in the diagram root\n    if (element.label) {\n      allAffected.push(element.label);\n    }\n\n    if (element === shape) {\n      return [];\n    }\n\n    return filter(element.children, function(c) {\n      return c !== shape;\n    });\n  });\n\n  var offset = location === 'top' ? -120 : 120,\n      lanePosition = location === 'top' ? shape.y : shape.y + shape.height,\n      spacePos = lanePosition + (location === 'top' ? 10 : -10),\n      direction = location === 'top' ? 'n' : 's';\n\n  var adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n\n  spaceTool.makeSpace(\n    adjustments.movingShapes,\n    adjustments.resizingShapes,\n    { x: 0, y: offset },\n    direction,\n    spacePos\n  );\n\n  // (2) create new lane at open space\n  context.newLane = modeling.createShape({ type: 'bpmn:Lane' }, {\n    x: shape.x + (isRoot ? LANE_INDENTATION : 0),\n    y: lanePosition - (location === 'top' ? 120 : 0),\n    width: shape.width - (isRoot ? LANE_INDENTATION : 0),\n    height: 120\n  }, laneParent);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
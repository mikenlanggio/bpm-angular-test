{"ast":null,"code":"import inherits from 'inherits-browser';\nimport { is } from '../../../util/ModelUtil';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport lineIntersect from './util/LineIntersect';\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n\n  this.preExecute('shape.delete', function (e) {\n    var shape = e.context.shape; // only handle [a] -> [shape] -> [b] patterns\n\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    var inConnection = shape.incoming[0],\n        outConnection = shape.outgoing[0]; // only handle sequence flows\n\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n}\ninherits(RemoveElementBehavior, CommandInterceptor);\nRemoveElementBehavior.$inject = ['eventBus', 'bpmnRules', 'modeling']; // helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n  var intersection = lineIntersect(getDocking(inWaypoints[inWaypoints.length - 2]), getDocking(inWaypoints[inWaypoints.length - 1]), getDocking(outWaypoints[1]), getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(inWaypoints.slice(0, inWaypoints.length - 1), [intersection], outWaypoints.slice(1));\n  } else {\n    return [getDocking(inWaypoints[0]), getDocking(outWaypoints[outWaypoints.length - 1])];\n  }\n}","map":{"version":3,"names":["inherits","is","CommandInterceptor","lineIntersect","RemoveElementBehavior","eventBus","bpmnRules","modeling","call","preExecute","e","shape","context","incoming","length","outgoing","inConnection","outConnection","canConnect","source","target","newWaypoints","getNewWaypoints","waypoints","reconnectEnd","$inject","getDocking","point","original","inWaypoints","outWaypoints","intersection","concat","slice"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveElementBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport lineIntersect from './util/LineIntersect';\n\n\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function(e) {\n\n    var shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    var inConnection = shape.incoming[0],\n        outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n\n  var intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [ intersection ],\n      outWaypoints.slice(1));\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1])\n    ];\n  }\n}"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,kBAArB;AAEA,SAASC,EAAT,QAAmB,yBAAnB;AAEA,OAAOC,kBAAP,MAA+B,2CAA/B;AAEA,OAAOC,aAAP,MAA0B,sBAA1B;AAGA,eAAe,SAASC,qBAAT,CAA+BC,QAA/B,EAAyCC,SAAzC,EAAoDC,QAApD,EAA8D;EAE3EL,kBAAkB,CAACM,IAAnB,CAAwB,IAAxB,EAA8BH,QAA9B;EAEA;AACF;AACA;AACA;AACA;;EACE,KAAKI,UAAL,CAAgB,cAAhB,EAAgC,UAASC,CAAT,EAAY;IAE1C,IAAIC,KAAK,GAAGD,CAAC,CAACE,OAAF,CAAUD,KAAtB,CAF0C,CAI1C;;IACA,IAAIA,KAAK,CAACE,QAAN,CAAeC,MAAf,KAA0B,CAA1B,IAA+BH,KAAK,CAACI,QAAN,CAAeD,MAAf,KAA0B,CAA7D,EAAgE;MAC9D;IACD;;IAED,IAAIE,YAAY,GAAGL,KAAK,CAACE,QAAN,CAAe,CAAf,CAAnB;IAAA,IACII,aAAa,GAAGN,KAAK,CAACI,QAAN,CAAe,CAAf,CADpB,CAT0C,CAY1C;;IACA,IAAI,CAACd,EAAE,CAACe,YAAD,EAAe,mBAAf,CAAH,IAA0C,CAACf,EAAE,CAACgB,aAAD,EAAgB,mBAAhB,CAAjD,EAAuF;MACrF;IACD;;IAED,IAAIX,SAAS,CAACY,UAAV,CAAqBF,YAAY,CAACG,MAAlC,EAA0CF,aAAa,CAACG,MAAxD,EAAgEJ,YAAhE,CAAJ,EAAmF;MAEjF;MACA,IAAIK,YAAY,GAAGC,eAAe,CAACN,YAAY,CAACO,SAAd,EAAyBN,aAAa,CAACM,SAAvC,CAAlC;MAEAhB,QAAQ,CAACiB,YAAT,CAAsBR,YAAtB,EAAoCC,aAAa,CAACG,MAAlD,EAA0DC,YAA1D;IACD;EACF,CAxBD;AA0BD;AAEDrB,QAAQ,CAACI,qBAAD,EAAwBF,kBAAxB,CAAR;AAEAE,qBAAqB,CAACqB,OAAtB,GAAgC,CAC9B,UAD8B,EAE9B,WAF8B,EAG9B,UAH8B,CAAhC,C,CAOA;;AAEA,SAASC,UAAT,CAAoBC,KAApB,EAA2B;EACzB,OAAOA,KAAK,CAACC,QAAN,IAAkBD,KAAzB;AACD;;AAGD,SAASL,eAAT,CAAyBO,WAAzB,EAAsCC,YAAtC,EAAoD;EAElD,IAAIC,YAAY,GAAG5B,aAAa,CAC9BuB,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAZ,GAAqB,CAAtB,CAAZ,CADoB,EAE9BY,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAZ,GAAqB,CAAtB,CAAZ,CAFoB,EAG9BY,UAAU,CAACI,YAAY,CAAC,CAAD,CAAb,CAHoB,EAI9BJ,UAAU,CAACI,YAAY,CAAC,CAAD,CAAb,CAJoB,CAAhC;;EAMA,IAAIC,YAAJ,EAAkB;IAChB,OAAO,GAAGC,MAAH,CACLH,WAAW,CAACI,KAAZ,CAAkB,CAAlB,EAAqBJ,WAAW,CAACf,MAAZ,GAAqB,CAA1C,CADK,EAEL,CAAEiB,YAAF,CAFK,EAGLD,YAAY,CAACG,KAAb,CAAmB,CAAnB,CAHK,CAAP;EAID,CALD,MAKO;IACL,OAAO,CACLP,UAAU,CAACG,WAAW,CAAC,CAAD,CAAZ,CADL,EAELH,UAAU,CAACI,YAAY,CAACA,YAAY,CAAChB,MAAb,GAAsB,CAAvB,CAAb,CAFL,CAAP;EAID;AACF"},"metadata":{},"sourceType":"module"}
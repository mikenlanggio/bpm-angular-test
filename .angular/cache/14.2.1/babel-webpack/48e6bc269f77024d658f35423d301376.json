{"ast":null,"code":"import { bind, find } from 'min-dash';\nimport TextBox from './TextBox';\n/**\n * A direct editing component that allows users\n * to edit an elements text directly in the diagram\n *\n * @param {EventBus} eventBus the event bus\n */\n\nexport default function DirectEditing(eventBus, canvas) {\n  this._eventBus = eventBus;\n  this._providers = [];\n  this._textbox = new TextBox({\n    container: canvas.getContainer(),\n    keyHandler: bind(this._handleKey, this),\n    resizeHandler: bind(this._handleResize, this)\n  });\n}\nDirectEditing.$inject = ['eventBus', 'canvas'];\n/**\n * Register a direct editing provider\n\n * @param {Object} provider the provider, must expose an #activate(element) method that returns\n *                          an activation context ({ bounds: {x, y, width, height }, text }) if\n *                          direct editing is available for the given element.\n *                          Additionally the provider must expose a #update(element, value) method\n *                          to receive direct editing updates.\n */\n\nDirectEditing.prototype.registerProvider = function (provider) {\n  this._providers.push(provider);\n};\n/**\n * Returns true if direct editing is currently active\n *\n * @param {djs.model.Base} [element]\n *\n * @return {boolean}\n */\n\n\nDirectEditing.prototype.isActive = function (element) {\n  return !!(this._active && (!element || this._active.element === element));\n};\n/**\n * Cancel direct editing, if it is currently active\n */\n\n\nDirectEditing.prototype.cancel = function () {\n  if (!this._active) {\n    return;\n  }\n\n  this._fire('cancel');\n\n  this.close();\n};\n\nDirectEditing.prototype._fire = function (event, context) {\n  this._eventBus.fire('directEditing.' + event, context || {\n    active: this._active\n  });\n};\n\nDirectEditing.prototype.close = function () {\n  this._textbox.destroy();\n\n  this._fire('deactivate');\n\n  this._active = null;\n  this.resizable = undefined;\n};\n\nDirectEditing.prototype.complete = function () {\n  var active = this._active;\n\n  if (!active) {\n    return;\n  }\n\n  var containerBounds,\n      previousBounds = active.context.bounds,\n      newBounds = this.$textbox.getBoundingClientRect(),\n      newText = this.getValue(),\n      previousText = active.context.text;\n\n  if (newText !== previousText || newBounds.height !== previousBounds.height || newBounds.width !== previousBounds.width) {\n    containerBounds = this._textbox.container.getBoundingClientRect();\n    active.provider.update(active.element, newText, active.context.text, {\n      x: newBounds.left - containerBounds.left,\n      y: newBounds.top - containerBounds.top,\n      width: newBounds.width,\n      height: newBounds.height\n    });\n  }\n\n  this._fire('complete');\n\n  this.close();\n};\n\nDirectEditing.prototype.getValue = function () {\n  return this._textbox.getValue();\n};\n\nDirectEditing.prototype._handleKey = function (e) {\n  // stop bubble\n  e.stopPropagation();\n  var key = e.keyCode || e.charCode; // ESC\n\n  if (key === 27) {\n    e.preventDefault();\n    return this.cancel();\n  } // Enter\n\n\n  if (key === 13 && !e.shiftKey) {\n    e.preventDefault();\n    return this.complete();\n  }\n};\n\nDirectEditing.prototype._handleResize = function (event) {\n  this._fire('resize', event);\n};\n/**\n * Activate direct editing on the given element\n *\n * @param {Object} ElementDescriptor the descriptor for a shape or connection\n * @return {Boolean} true if the activation was possible\n */\n\n\nDirectEditing.prototype.activate = function (element) {\n  if (this.isActive()) {\n    this.cancel();\n  } // the direct editing context\n\n\n  var context;\n  var provider = find(this._providers, function (p) {\n    return (context = p.activate(element)) ? p : null;\n  }); // check if activation took place\n\n  if (context) {\n    this.$textbox = this._textbox.create(context.bounds, context.style, context.text, context.options);\n    this._active = {\n      element: element,\n      context: context,\n      provider: provider\n    };\n\n    if (context.options && context.options.resizable) {\n      this.resizable = true;\n    }\n\n    this._fire('activate');\n  }\n\n  return !!context;\n};","map":{"version":3,"names":["bind","find","TextBox","DirectEditing","eventBus","canvas","_eventBus","_providers","_textbox","container","getContainer","keyHandler","_handleKey","resizeHandler","_handleResize","$inject","prototype","registerProvider","provider","push","isActive","element","_active","cancel","_fire","close","event","context","fire","active","destroy","resizable","undefined","complete","containerBounds","previousBounds","bounds","newBounds","$textbox","getBoundingClientRect","newText","getValue","previousText","text","height","width","update","x","left","y","top","e","stopPropagation","key","keyCode","charCode","preventDefault","shiftKey","activate","p","create","style","options"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js-direct-editing/lib/DirectEditing.js"],"sourcesContent":["import {\n  bind,\n  find\n} from 'min-dash';\n\nimport TextBox from './TextBox';\n\n\n/**\n * A direct editing component that allows users\n * to edit an elements text directly in the diagram\n *\n * @param {EventBus} eventBus the event bus\n */\nexport default function DirectEditing(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n\n  this._providers = [];\n  this._textbox = new TextBox({\n    container: canvas.getContainer(),\n    keyHandler: bind(this._handleKey, this),\n    resizeHandler: bind(this._handleResize, this)\n  });\n}\n\nDirectEditing.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Register a direct editing provider\n\n * @param {Object} provider the provider, must expose an #activate(element) method that returns\n *                          an activation context ({ bounds: {x, y, width, height }, text }) if\n *                          direct editing is available for the given element.\n *                          Additionally the provider must expose a #update(element, value) method\n *                          to receive direct editing updates.\n */\nDirectEditing.prototype.registerProvider = function(provider) {\n  this._providers.push(provider);\n};\n\n\n/**\n * Returns true if direct editing is currently active\n *\n * @param {djs.model.Base} [element]\n *\n * @return {boolean}\n */\nDirectEditing.prototype.isActive = function(element) {\n  return !!(this._active && (!element || this._active.element === element));\n};\n\n\n/**\n * Cancel direct editing, if it is currently active\n */\nDirectEditing.prototype.cancel = function() {\n  if (!this._active) {\n    return;\n  }\n\n  this._fire('cancel');\n  this.close();\n};\n\n\nDirectEditing.prototype._fire = function(event, context) {\n  this._eventBus.fire('directEditing.' + event, context || { active: this._active });\n};\n\nDirectEditing.prototype.close = function() {\n  this._textbox.destroy();\n\n  this._fire('deactivate');\n\n  this._active = null;\n\n  this.resizable = undefined;\n};\n\n\nDirectEditing.prototype.complete = function() {\n\n  var active = this._active;\n\n  if (!active) {\n    return;\n  }\n\n  var containerBounds,\n      previousBounds = active.context.bounds,\n      newBounds = this.$textbox.getBoundingClientRect(),\n      newText = this.getValue(),\n      previousText = active.context.text;\n\n  if (\n    newText !== previousText ||\n    newBounds.height !== previousBounds.height ||\n    newBounds.width !== previousBounds.width\n  ) {\n    containerBounds = this._textbox.container.getBoundingClientRect();\n\n    active.provider.update(active.element, newText, active.context.text, {\n      x: newBounds.left - containerBounds.left,\n      y: newBounds.top - containerBounds.top,\n      width: newBounds.width,\n      height: newBounds.height\n    });\n  }\n\n  this._fire('complete');\n\n  this.close();\n};\n\n\nDirectEditing.prototype.getValue = function() {\n  return this._textbox.getValue();\n};\n\n\nDirectEditing.prototype._handleKey = function(e) {\n\n  // stop bubble\n  e.stopPropagation();\n\n  var key = e.keyCode || e.charCode;\n\n  // ESC\n  if (key === 27) {\n    e.preventDefault();\n    return this.cancel();\n  }\n\n  // Enter\n  if (key === 13 && !e.shiftKey) {\n    e.preventDefault();\n    return this.complete();\n  }\n};\n\n\nDirectEditing.prototype._handleResize = function(event) {\n  this._fire('resize', event);\n};\n\n\n/**\n * Activate direct editing on the given element\n *\n * @param {Object} ElementDescriptor the descriptor for a shape or connection\n * @return {Boolean} true if the activation was possible\n */\nDirectEditing.prototype.activate = function(element) {\n  if (this.isActive()) {\n    this.cancel();\n  }\n\n  // the direct editing context\n  var context;\n\n  var provider = find(this._providers, function(p) {\n    return (context = p.activate(element)) ? p : null;\n  });\n\n  // check if activation took place\n  if (context) {\n    this.$textbox = this._textbox.create(\n      context.bounds,\n      context.style,\n      context.text,\n      context.options\n    );\n\n    this._active = {\n      element: element,\n      context: context,\n      provider: provider\n    };\n\n    if (context.options && context.options.resizable) {\n      this.resizable = true;\n    }\n\n    this._fire('activate');\n  }\n\n  return !!context;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
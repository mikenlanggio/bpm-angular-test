{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getDi, is } from '../../../util/ModelUtil';\nimport { computeChildrenBBox } from 'diagram-js/lib/features/resize/ResizeUtil';\nvar LOW_PRIORITY = 500;\nexport default function ToggleElementCollapseBehaviour(eventBus, elementFactory, modeling, resize) {\n  CommandInterceptor.call(this, eventBus);\n\n  function hideEmptyLabels(children) {\n    if (children.length) {\n      children.forEach(function (child) {\n        if (child.type === 'label' && !child.businessObject.name) {\n          child.hidden = true;\n        }\n      });\n    }\n  }\n\n  function expandedBounds(shape, defaultSize) {\n    var children = shape.children,\n        newBounds = defaultSize,\n        visibleElements,\n        visibleBBox;\n    visibleElements = filterVisible(children).concat([shape]);\n    visibleBBox = computeChildrenBBox(visibleElements);\n\n    if (visibleBBox) {\n      // center to visibleBBox with max(defaultSize, childrenBounds)\n      newBounds.width = Math.max(visibleBBox.width, newBounds.width);\n      newBounds.height = Math.max(visibleBBox.height, newBounds.height);\n      newBounds.x = visibleBBox.x + (visibleBBox.width - newBounds.width) / 2;\n      newBounds.y = visibleBBox.y + (visibleBBox.height - newBounds.height) / 2;\n    } else {\n      // center to collapsed shape with defaultSize\n      newBounds.x = shape.x + (shape.width - newBounds.width) / 2;\n      newBounds.y = shape.y + (shape.height - newBounds.height) / 2;\n    }\n\n    return newBounds;\n  }\n\n  function collapsedBounds(shape, defaultSize) {\n    return {\n      x: shape.x + (shape.width - defaultSize.width) / 2,\n      y: shape.y + (shape.height - defaultSize.height) / 2,\n      width: defaultSize.width,\n      height: defaultSize.height\n    };\n  }\n\n  this.executed(['shape.toggleCollapse'], LOW_PRIORITY, function (e) {\n    var context = e.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!shape.collapsed) {\n      // all children got made visible through djs, hide empty labels\n      hideEmptyLabels(shape.children); // remove collapsed marker\n\n      getDi(shape).isExpanded = true;\n    } else {\n      // place collapsed marker\n      getDi(shape).isExpanded = false;\n    }\n  });\n  this.reverted(['shape.toggleCollapse'], LOW_PRIORITY, function (e) {\n    var context = e.context;\n    var shape = context.shape; // revert removing/placing collapsed marker\n\n    if (!shape.collapsed) {\n      getDi(shape).isExpanded = true;\n    } else {\n      getDi(shape).isExpanded = false;\n    }\n  });\n  this.postExecuted(['shape.toggleCollapse'], LOW_PRIORITY, function (e) {\n    var shape = e.context.shape,\n        defaultSize = elementFactory.getDefaultSize(shape),\n        newBounds;\n\n    if (shape.collapsed) {\n      // resize to default size of collapsed shapes\n      newBounds = collapsedBounds(shape, defaultSize);\n    } else {\n      // resize to bounds of max(visible children, defaultSize)\n      newBounds = expandedBounds(shape, defaultSize);\n    }\n\n    modeling.resizeShape(shape, newBounds, null, {\n      autoResize: shape.collapsed ? false : 'nwse'\n    });\n  });\n}\ninherits(ToggleElementCollapseBehaviour, CommandInterceptor);\nToggleElementCollapseBehaviour.$inject = ['eventBus', 'elementFactory', 'modeling']; // helpers //////////////////////\n\nfunction filterVisible(elements) {\n  return elements.filter(function (e) {\n    return !e.hidden;\n  });\n}","map":{"version":3,"names":["inherits","CommandInterceptor","getDi","is","computeChildrenBBox","LOW_PRIORITY","ToggleElementCollapseBehaviour","eventBus","elementFactory","modeling","resize","call","hideEmptyLabels","children","length","forEach","child","type","businessObject","name","hidden","expandedBounds","shape","defaultSize","newBounds","visibleElements","visibleBBox","filterVisible","concat","width","Math","max","height","x","y","collapsedBounds","executed","e","context","collapsed","isExpanded","reverted","postExecuted","getDefaultSize","resizeShape","autoResize","$inject","elements","filter"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/modeling/behavior/ToggleElementCollapseBehaviour.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getDi,\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  computeChildrenBBox\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n\nvar LOW_PRIORITY = 500;\n\n\nexport default function ToggleElementCollapseBehaviour(\n    eventBus, elementFactory, modeling,\n    resize) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  function hideEmptyLabels(children) {\n    if (children.length) {\n      children.forEach(function(child) {\n        if (child.type === 'label' && !child.businessObject.name) {\n          child.hidden = true;\n        }\n      });\n    }\n  }\n\n  function expandedBounds(shape, defaultSize) {\n    var children = shape.children,\n        newBounds = defaultSize,\n        visibleElements,\n        visibleBBox;\n\n    visibleElements = filterVisible(children).concat([ shape ]);\n\n    visibleBBox = computeChildrenBBox(visibleElements);\n\n    if (visibleBBox) {\n\n      // center to visibleBBox with max(defaultSize, childrenBounds)\n      newBounds.width = Math.max(visibleBBox.width, newBounds.width);\n      newBounds.height = Math.max(visibleBBox.height, newBounds.height);\n\n      newBounds.x = visibleBBox.x + (visibleBBox.width - newBounds.width) / 2;\n      newBounds.y = visibleBBox.y + (visibleBBox.height - newBounds.height) / 2;\n    } else {\n\n      // center to collapsed shape with defaultSize\n      newBounds.x = shape.x + (shape.width - newBounds.width) / 2;\n      newBounds.y = shape.y + (shape.height - newBounds.height) / 2;\n    }\n\n    return newBounds;\n  }\n\n  function collapsedBounds(shape, defaultSize) {\n\n    return {\n      x: shape.x + (shape.width - defaultSize.width) / 2,\n      y: shape.y + (shape.height - defaultSize.height) / 2,\n      width: defaultSize.width,\n      height: defaultSize.height\n    };\n  }\n\n  this.executed([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!shape.collapsed) {\n\n      // all children got made visible through djs, hide empty labels\n      hideEmptyLabels(shape.children);\n\n      // remove collapsed marker\n      getDi(shape).isExpanded = true;\n    } else {\n\n      // place collapsed marker\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.reverted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context;\n    var shape = context.shape;\n\n\n    // revert removing/placing collapsed marker\n    if (!shape.collapsed) {\n      getDi(shape).isExpanded = true;\n\n    } else {\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.postExecuted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n    var shape = e.context.shape,\n        defaultSize = elementFactory.getDefaultSize(shape),\n        newBounds;\n\n    if (shape.collapsed) {\n\n      // resize to default size of collapsed shapes\n      newBounds = collapsedBounds(shape, defaultSize);\n    } else {\n\n      // resize to bounds of max(visible children, defaultSize)\n      newBounds = expandedBounds(shape, defaultSize);\n    }\n\n    modeling.resizeShape(shape, newBounds, null, {\n      autoResize: shape.collapsed ? false : 'nwse'\n    });\n  });\n\n}\n\n\ninherits(ToggleElementCollapseBehaviour, CommandInterceptor);\n\nToggleElementCollapseBehaviour.$inject = [\n  'eventBus',\n  'elementFactory',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction filterVisible(elements) {\n  return elements.filter(function(e) {\n    return !e.hidden;\n  });\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
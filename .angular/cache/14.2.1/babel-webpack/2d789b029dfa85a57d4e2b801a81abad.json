{"ast":null,"code":"import { is } from '../../util/ModelUtil';\nimport { isAny } from '../modeling/util/ModelingUtil';\nimport { getMid, asTRBL, getOrientation } from 'diagram-js/lib/layout/LayoutUtil';\nimport { findFreePosition, generateGetNextPosition, getConnectedDistance } from 'diagram-js/lib/features/auto-place/AutoPlaceUtil';\n/**\n * Find the new position for the target element to\n * connect to source.\n *\n * @param  {djs.model.Shape} source\n * @param  {djs.model.Shape} element\n *\n * @return {Point}\n */\n\nexport function getNewShapePosition(source, element) {\n  if (is(element, 'bpmn:TextAnnotation')) {\n    return getTextAnnotationPosition(source, element);\n  }\n\n  if (isAny(element, ['bpmn:DataObjectReference', 'bpmn:DataStoreReference'])) {\n    return getDataElementPosition(source, element);\n  }\n\n  if (is(element, 'bpmn:FlowNode')) {\n    return getFlowNodePosition(source, element);\n  }\n}\n/**\n * Always try to place element right of source;\n * compute actual distance from previous nodes in flow.\n */\n\nexport function getFlowNodePosition(source, element) {\n  var sourceTrbl = asTRBL(source);\n  var sourceMid = getMid(source);\n  var horizontalDistance = getConnectedDistance(source, {\n    filter: function (connection) {\n      return is(connection, 'bpmn:SequenceFlow');\n    }\n  });\n  var margin = 30,\n      minDistance = 80,\n      orientation = 'left';\n\n  if (is(source, 'bpmn:BoundaryEvent')) {\n    orientation = getOrientation(source, source.host, -25);\n\n    if (orientation.indexOf('top') !== -1) {\n      margin *= -1;\n    }\n  }\n\n  var position = {\n    x: sourceTrbl.right + horizontalDistance + element.width / 2,\n    y: sourceMid.y + getVerticalDistance(orientation, minDistance)\n  };\n  var nextPositionDirection = {\n    y: {\n      margin: margin,\n      minDistance: minDistance\n    }\n  };\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\nfunction getVerticalDistance(orientation, minDistance) {\n  if (orientation.indexOf('top') != -1) {\n    return -1 * minDistance;\n  } else if (orientation.indexOf('bottom') != -1) {\n    return minDistance;\n  } else {\n    return 0;\n  }\n}\n/**\n * Always try to place text annotations top right of source.\n */\n\n\nexport function getTextAnnotationPosition(source, element) {\n  var sourceTrbl = asTRBL(source);\n  var position = {\n    x: sourceTrbl.right + element.width / 2,\n    y: sourceTrbl.top - 50 - element.height / 2\n  };\n\n  if (isConnection(source)) {\n    position = getMid(source);\n    position.x += 100;\n    position.y -= 50;\n  }\n\n  var nextPositionDirection = {\n    y: {\n      margin: -30,\n      minDistance: 20\n    }\n  };\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n/**\n * Always put element bottom right of source.\n */\n\nexport function getDataElementPosition(source, element) {\n  var sourceTrbl = asTRBL(source);\n  var position = {\n    x: sourceTrbl.right - 10 + element.width / 2,\n    y: sourceTrbl.bottom + 40 + element.width / 2\n  };\n  var nextPositionDirection = {\n    x: {\n      margin: 30,\n      minDistance: 30\n    }\n  };\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}","map":{"version":3,"names":["is","isAny","getMid","asTRBL","getOrientation","findFreePosition","generateGetNextPosition","getConnectedDistance","getNewShapePosition","source","element","getTextAnnotationPosition","getDataElementPosition","getFlowNodePosition","sourceTrbl","sourceMid","horizontalDistance","filter","connection","margin","minDistance","orientation","host","indexOf","position","x","right","width","y","getVerticalDistance","nextPositionDirection","top","height","isConnection","bottom","waypoints"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/auto-place/BpmnAutoPlaceUtil.js"],"sourcesContent":["import { is } from '../../util/ModelUtil';\nimport { isAny } from '../modeling/util/ModelingUtil';\n\nimport {\n  getMid,\n  asTRBL,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  findFreePosition,\n  generateGetNextPosition,\n  getConnectedDistance\n} from 'diagram-js/lib/features/auto-place/AutoPlaceUtil';\n\n\n/**\n * Find the new position for the target element to\n * connect to source.\n *\n * @param  {djs.model.Shape} source\n * @param  {djs.model.Shape} element\n *\n * @return {Point}\n */\nexport function getNewShapePosition(source, element) {\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    return getTextAnnotationPosition(source, element);\n  }\n\n  if (isAny(element, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    return getDataElementPosition(source, element);\n  }\n\n  if (is(element, 'bpmn:FlowNode')) {\n    return getFlowNodePosition(source, element);\n  }\n}\n\n/**\n * Always try to place element right of source;\n * compute actual distance from previous nodes in flow.\n */\nexport function getFlowNodePosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n  var sourceMid = getMid(source);\n\n  var horizontalDistance = getConnectedDistance(source, {\n    filter: function(connection) {\n      return is(connection, 'bpmn:SequenceFlow');\n    }\n  });\n\n  var margin = 30,\n      minDistance = 80,\n      orientation = 'left';\n\n  if (is(source, 'bpmn:BoundaryEvent')) {\n    orientation = getOrientation(source, source.host, -25);\n\n    if (orientation.indexOf('top') !== -1) {\n      margin *= -1;\n    }\n  }\n\n  var position = {\n    x: sourceTrbl.right + horizontalDistance + element.width / 2,\n    y: sourceMid.y + getVerticalDistance(orientation, minDistance)\n  };\n\n  var nextPositionDirection = {\n    y: {\n      margin: margin,\n      minDistance: minDistance\n    }\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n\nfunction getVerticalDistance(orientation, minDistance) {\n  if (orientation.indexOf('top') != -1) {\n    return -1 * minDistance;\n  } else if (orientation.indexOf('bottom') != -1) {\n    return minDistance;\n  } else {\n    return 0;\n  }\n}\n\n\n/**\n * Always try to place text annotations top right of source.\n */\nexport function getTextAnnotationPosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var position = {\n    x: sourceTrbl.right + element.width / 2,\n    y: sourceTrbl.top - 50 - element.height / 2\n  };\n\n  if (isConnection(source)) {\n    position = getMid(source);\n    position.x += 100;\n    position.y -= 50;\n  }\n\n  var nextPositionDirection = {\n    y: {\n      margin: -30,\n      minDistance: 20\n    }\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n\n/**\n * Always put element bottom right of source.\n */\nexport function getDataElementPosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var position = {\n    x: sourceTrbl.right - 10 + element.width / 2,\n    y: sourceTrbl.bottom + 40 + element.width / 2\n  };\n\n  var nextPositionDirection = {\n    x: {\n      margin: 30,\n      minDistance: 30\n    }\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
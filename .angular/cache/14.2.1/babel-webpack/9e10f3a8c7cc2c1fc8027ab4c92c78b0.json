{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../../util/ModelUtil';\nimport { isExpanded } from '../../../util/DiUtil';\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\nimport { getResizedSourceAnchor, getResizedTargetAnchor } from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\n/**\r\n * BPMN-specific message flow behavior.\r\n */\n\nexport default function MessageFlowBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  this.postExecute('shape.replace', function (context) {\n    var oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    if (!isParticipantCollapse(oldShape, newShape)) {\n      return;\n    }\n\n    var messageFlows = getMessageFlows(oldShape);\n    messageFlows.incoming.forEach(function (incoming) {\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\n      modeling.reconnectEnd(incoming, newShape, anchor);\n    });\n    messageFlows.outgoing.forEach(function (outgoing) {\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\n      modeling.reconnectStart(outgoing, newShape, anchor);\n    });\n  }, true);\n}\nMessageFlowBehavior.$inject = ['eventBus', 'modeling'];\ninherits(MessageFlowBehavior, CommandInterceptor); // helpers //////////\n\nfunction isParticipantCollapse(oldShape, newShape) {\n  return is(oldShape, 'bpmn:Participant') && isExpanded(oldShape) && is(newShape, 'bpmn:Participant') && !isExpanded(newShape);\n}\n\nfunction getMessageFlows(parent) {\n  var elements = selfAndAllChildren([parent], false);\n  var incoming = [],\n      outgoing = [];\n  elements.forEach(function (element) {\n    if (element === parent) {\n      return;\n    }\n\n    element.incoming.forEach(function (connection) {\n      if (is(connection, 'bpmn:MessageFlow')) {\n        incoming.push(connection);\n      }\n    });\n    element.outgoing.forEach(function (connection) {\n      if (is(connection, 'bpmn:MessageFlow')) {\n        outgoing.push(connection);\n      }\n    });\n  }, []);\n  return {\n    incoming: incoming,\n    outgoing: outgoing\n  };\n}","map":{"version":3,"names":["inherits","CommandInterceptor","is","isExpanded","selfAndAllChildren","getResizedSourceAnchor","getResizedTargetAnchor","MessageFlowBehavior","eventBus","modeling","call","postExecute","context","oldShape","newShape","isParticipantCollapse","messageFlows","getMessageFlows","incoming","forEach","anchor","reconnectEnd","outgoing","reconnectStart","$inject","parent","elements","element","connection","push"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/modeling/behavior/MessageFlowBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport { isExpanded } from '../../../util/DiUtil';\r\n\r\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\r\n\r\n/**\r\n * BPMN-specific message flow behavior.\r\n */\r\nexport default function MessageFlowBehavior(eventBus, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this.postExecute('shape.replace', function(context) {\r\n    var oldShape = context.oldShape,\r\n        newShape = context.newShape;\r\n\r\n    if (!isParticipantCollapse(oldShape, newShape)) {\r\n      return;\r\n    }\r\n\r\n    var messageFlows = getMessageFlows(oldShape);\r\n\r\n    messageFlows.incoming.forEach(function(incoming) {\r\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\r\n\r\n      modeling.reconnectEnd(incoming, newShape, anchor);\r\n    });\r\n\r\n    messageFlows.outgoing.forEach(function(outgoing) {\r\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\r\n\r\n      modeling.reconnectStart(outgoing, newShape, anchor);\r\n    });\r\n  }, true);\r\n\r\n}\r\n\r\nMessageFlowBehavior.$inject = [ 'eventBus', 'modeling' ];\r\n\r\ninherits(MessageFlowBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction isParticipantCollapse(oldShape, newShape) {\r\n  return is(oldShape, 'bpmn:Participant')\r\n    && isExpanded(oldShape)\r\n    && is(newShape, 'bpmn:Participant')\r\n    && !isExpanded(newShape);\r\n}\r\n\r\nfunction getMessageFlows(parent) {\r\n  var elements = selfAndAllChildren([ parent ], false);\r\n\r\n  var incoming = [],\r\n      outgoing = [];\r\n\r\n  elements.forEach(function(element) {\r\n    if (element === parent) {\r\n      return;\r\n    }\r\n\r\n    element.incoming.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        incoming.push(connection);\r\n      }\r\n    });\r\n\r\n    element.outgoing.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        outgoing.push(connection);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    incoming: incoming,\r\n    outgoing: outgoing\r\n  };\r\n}"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,kBAArB;AAEA,OAAOC,kBAAP,MAA+B,2CAA/B;AAEA,SAASC,EAAT,QAAmB,yBAAnB;AAEA,SAASC,UAAT,QAA2B,sBAA3B;AAEA,SAASC,kBAAT,QAAmC,8BAAnC;AAEA,SACEC,sBADF,EAEEC,sBAFF,QAGO,2DAHP;AAKA;AACA;AACA;;AACA,eAAe,SAASC,mBAAT,CAA6BC,QAA7B,EAAuCC,QAAvC,EAAiD;EAE9DR,kBAAkB,CAACS,IAAnB,CAAwB,IAAxB,EAA8BF,QAA9B;EAEA,KAAKG,WAAL,CAAiB,eAAjB,EAAkC,UAASC,OAAT,EAAkB;IAClD,IAAIC,QAAQ,GAAGD,OAAO,CAACC,QAAvB;IAAA,IACIC,QAAQ,GAAGF,OAAO,CAACE,QADvB;;IAGA,IAAI,CAACC,qBAAqB,CAACF,QAAD,EAAWC,QAAX,CAA1B,EAAgD;MAC9C;IACD;;IAED,IAAIE,YAAY,GAAGC,eAAe,CAACJ,QAAD,CAAlC;IAEAG,YAAY,CAACE,QAAb,CAAsBC,OAAtB,CAA8B,UAASD,QAAT,EAAmB;MAC/C,IAAIE,MAAM,GAAGd,sBAAsB,CAACY,QAAD,EAAWJ,QAAX,EAAqBD,QAArB,CAAnC;MAEAJ,QAAQ,CAACY,YAAT,CAAsBH,QAAtB,EAAgCJ,QAAhC,EAA0CM,MAA1C;IACD,CAJD;IAMAJ,YAAY,CAACM,QAAb,CAAsBH,OAAtB,CAA8B,UAASG,QAAT,EAAmB;MAC/C,IAAIF,MAAM,GAAGf,sBAAsB,CAACiB,QAAD,EAAWR,QAAX,EAAqBD,QAArB,CAAnC;MAEAJ,QAAQ,CAACc,cAAT,CAAwBD,QAAxB,EAAkCR,QAAlC,EAA4CM,MAA5C;IACD,CAJD;EAKD,CArBD,EAqBG,IArBH;AAuBD;AAEDb,mBAAmB,CAACiB,OAApB,GAA8B,CAAE,UAAF,EAAc,UAAd,CAA9B;AAEAxB,QAAQ,CAACO,mBAAD,EAAsBN,kBAAtB,CAAR,C,CAEA;;AAEA,SAASc,qBAAT,CAA+BF,QAA/B,EAAyCC,QAAzC,EAAmD;EACjD,OAAOZ,EAAE,CAACW,QAAD,EAAW,kBAAX,CAAF,IACFV,UAAU,CAACU,QAAD,CADR,IAEFX,EAAE,CAACY,QAAD,EAAW,kBAAX,CAFA,IAGF,CAACX,UAAU,CAACW,QAAD,CAHhB;AAID;;AAED,SAASG,eAAT,CAAyBQ,MAAzB,EAAiC;EAC/B,IAAIC,QAAQ,GAAGtB,kBAAkB,CAAC,CAAEqB,MAAF,CAAD,EAAa,KAAb,CAAjC;EAEA,IAAIP,QAAQ,GAAG,EAAf;EAAA,IACII,QAAQ,GAAG,EADf;EAGAI,QAAQ,CAACP,OAAT,CAAiB,UAASQ,OAAT,EAAkB;IACjC,IAAIA,OAAO,KAAKF,MAAhB,EAAwB;MACtB;IACD;;IAEDE,OAAO,CAACT,QAAR,CAAiBC,OAAjB,CAAyB,UAASS,UAAT,EAAqB;MAC5C,IAAI1B,EAAE,CAAC0B,UAAD,EAAa,kBAAb,CAAN,EAAwC;QACtCV,QAAQ,CAACW,IAAT,CAAcD,UAAd;MACD;IACF,CAJD;IAMAD,OAAO,CAACL,QAAR,CAAiBH,OAAjB,CAAyB,UAASS,UAAT,EAAqB;MAC5C,IAAI1B,EAAE,CAAC0B,UAAD,EAAa,kBAAb,CAAN,EAAwC;QACtCN,QAAQ,CAACO,IAAT,CAAcD,UAAd;MACD;IACF,CAJD;EAKD,CAhBD,EAgBG,EAhBH;EAkBA,OAAO;IACLV,QAAQ,EAAEA,QADL;IAELI,QAAQ,EAAEA;EAFL,CAAP;AAID"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import { assign } from 'min-dash';\nimport inherits from 'inherits-browser';\nimport { is, getBusinessObject, getDi } from '../../../util/ModelUtil';\nimport { isLabelExternal, getExternalLabelMid, hasExternalLabel, isLabel } from '../../../util/LabelUtil';\nimport { getLabel } from '../../label-editing/LabelUtil';\nimport { getLabelAdjustment } from './util/LabelLayoutUtil';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getNewAttachPoint } from 'diagram-js/lib/util/AttachUtil';\nimport { getMid, roundPoint } from 'diagram-js/lib/layout/LayoutUtil';\nimport { delta } from 'diagram-js/lib/util/PositionUtil';\nimport { sortBy } from 'min-dash';\nimport { getDistancePointLine, perpendicularFoot } from './util/GeometricUtil';\nvar DEFAULT_LABEL_DIMENSIONS = {\n  width: 90,\n  height: 20\n};\nvar NAME_PROPERTY = 'name';\nvar TEXT_PROPERTY = 'text';\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnFactory} bpmnFactory\n * @param {TextRenderer} textRenderer\n */\n\nexport default function LabelBehavior(eventBus, modeling, bpmnFactory, textRenderer) {\n  CommandInterceptor.call(this, eventBus); // update label if name property was updated\n\n  this.postExecute('element.updateProperties', function (e) {\n    var context = e.context,\n        element = context.element,\n        properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n\n    if (TEXT_PROPERTY in properties && is(element, 'bpmn:TextAnnotation')) {\n      var newBounds = textRenderer.getTextAnnotationBounds({\n        x: element.x,\n        y: element.y,\n        width: element.width,\n        height: element.height\n      }, properties[TEXT_PROPERTY] || '');\n      modeling.updateLabel(element, properties.text, newBounds);\n    }\n  }); // create label shape after shape/connection was created\n\n  this.postExecute(['shape.create', 'connection.create'], function (e) {\n    var context = e.context,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    var element = context.shape || context.connection,\n        businessObject = element.businessObject;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    } // only create label if attribute available\n\n\n    if (!getLabel(element)) {\n      return;\n    }\n\n    var labelCenter = getExternalLabelMid(element); // we don't care about x and y\n\n    var labelDimensions = textRenderer.getExternalLabelBounds(DEFAULT_LABEL_DIMENSIONS, getLabel(element));\n    modeling.createLabel(element, labelCenter, {\n      id: businessObject.id + '_label',\n      businessObject: businessObject,\n      width: labelDimensions.width,\n      height: labelDimensions.height\n    });\n  }); // update label after label shape was deleted\n\n  this.postExecute('shape.delete', function (event) {\n    var context = event.context,\n        labelTarget = context.labelTarget,\n        hints = context.hints || {}; // check if label\n\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, {\n        removeShape: false\n      });\n    }\n  }); // update di information on label creation\n\n  this.postExecute(['label.create'], function (event) {\n    var context = event.context,\n        element = context.shape,\n        labelTarget = context.labelTarget,\n        di; // we want to trigger on real labels only\n\n    if (!labelTarget) {\n      return;\n    } // we want to trigger on BPMN elements only\n\n\n    if (!is(labelTarget, 'bpmn:BaseElement')) {\n      return;\n    }\n\n    di = getDi(labelTarget);\n\n    if (!di.label) {\n      di.label = bpmnFactory.create('bpmndi:BPMNLabel', {\n        bounds: bpmnFactory.create('dc:Bounds')\n      });\n      element.di = di;\n    }\n\n    assign(di.label.bounds, {\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    });\n  });\n\n  function getVisibleLabelAdjustment(event) {\n    var context = event.context,\n        connection = context.connection,\n        label = connection.label,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute(['connection.layout', 'connection.updateWaypoints'], function (event) {\n    var context = event.context,\n        hints = context.hints || {};\n\n    if (hints.labelBehavior === false) {\n      return;\n    }\n\n    var connection = context.connection,\n        label = connection.label,\n        labelAdjustment; // handle missing label as well as the case\n    // that the label parent does not exist (yet),\n    // because it is being pasted / created via multi element create\n    //\n    // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n\n    if (!label || !label.parent) {\n      return;\n    }\n\n    labelAdjustment = getVisibleLabelAdjustment(event);\n    modeling.moveShape(label, labelAdjustment);\n  }); // keep label position on shape replace\n\n  this.postExecute(['shape.replace'], function (event) {\n    var context = event.context,\n        newShape = context.newShape,\n        oldShape = context.oldShape;\n    var businessObject = getBusinessObject(newShape);\n\n    if (businessObject && isLabelExternal(businessObject) && oldShape.label && newShape.label) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  }); // move external label after resizing\n\n  this.postExecute('shape.resize', function (event) {\n    var context = event.context,\n        shape = context.shape,\n        newBounds = context.newBounds,\n        oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n      var label = shape.label,\n          labelMid = getMid(label),\n          edges = asEdges(oldBounds); // get nearest border point to label as reference point\n\n      var referencePoint = getReferencePoint(labelMid, edges);\n      var delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n      modeling.moveShape(label, delta);\n    }\n  });\n}\ninherits(LabelBehavior, CommandInterceptor);\nLabelBehavior.$inject = ['eventBus', 'modeling', 'bpmnFactory', 'textRenderer']; // helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} point\n * @param {Bounds} oldBounds\n * @param {Bounds} newBounds\n *\n * @return {Delta} delta\n */\n\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n  var newReferencePoint = getNewAttachPoint(referencePoint, oldBounds, newBounds);\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Array<Point, Point>} lines\n * @param {Point} point\n *\n * @param {Point}\n */\n\nexport function getReferencePoint(point, lines) {\n  if (!lines.length) {\n    return;\n  }\n\n  var nearestLine = getNearestLine(point, lines);\n  return perpendicularFoot(point, nearestLine);\n}\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Bounds|Point} bounds\n *\n * @return Array<Point>\n */\n\nexport function asEdges(bounds) {\n  return [[// top\n  {\n    x: bounds.x,\n    y: bounds.y\n  }, {\n    x: bounds.x + (bounds.width || 0),\n    y: bounds.y\n  }], [// right\n  {\n    x: bounds.x + (bounds.width || 0),\n    y: bounds.y\n  }, {\n    x: bounds.x + (bounds.width || 0),\n    y: bounds.y + (bounds.height || 0)\n  }], [// bottom\n  {\n    x: bounds.x,\n    y: bounds.y + (bounds.height || 0)\n  }, {\n    x: bounds.x + (bounds.width || 0),\n    y: bounds.y + (bounds.height || 0)\n  }], [// left\n  {\n    x: bounds.x,\n    y: bounds.y\n  }, {\n    x: bounds.x,\n    y: bounds.y + (bounds.height || 0)\n  }]];\n}\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param Array<Point> lines\n *\n * @return Array<Point>\n */\n\nfunction getNearestLine(point, lines) {\n  var distances = lines.map(function (l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l)\n    };\n  });\n  var sorted = sortBy(distances, 'distance');\n  return sorted[0].line;\n}","map":{"version":3,"names":["assign","inherits","is","getBusinessObject","getDi","isLabelExternal","getExternalLabelMid","hasExternalLabel","isLabel","getLabel","getLabelAdjustment","CommandInterceptor","getNewAttachPoint","getMid","roundPoint","delta","sortBy","getDistancePointLine","perpendicularFoot","DEFAULT_LABEL_DIMENSIONS","width","height","NAME_PROPERTY","TEXT_PROPERTY","LabelBehavior","eventBus","modeling","bpmnFactory","textRenderer","call","postExecute","e","context","element","properties","updateLabel","newBounds","getTextAnnotationBounds","x","y","text","hints","createElementsBehavior","shape","connection","businessObject","labelCenter","labelDimensions","getExternalLabelBounds","createLabel","id","event","labelTarget","unsetLabel","removeShape","di","label","create","bounds","getVisibleLabelAdjustment","newWaypoints","waypoints","oldWaypoints","startChanged","connectionStart","endChanged","connectionEnd","labelBehavior","labelAdjustment","parent","moveShape","newShape","oldShape","oldBounds","labelMid","edges","asEdges","referencePoint","getReferencePoint","getReferencePointDelta","$inject","newReferencePoint","point","lines","length","nearestLine","getNearestLine","distances","map","l","line","distance","sorted"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/modeling/behavior/LabelBehavior.js"],"sourcesContent":["import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  is,\n  getBusinessObject,\n  getDi\n} from '../../../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getExternalLabelMid,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getLabel\n} from '../../label-editing/LabelUtil';\n\nimport {\n  getLabelAdjustment\n} from './util/LabelLayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getNewAttachPoint\n} from 'diagram-js/lib/util/AttachUtil';\n\nimport {\n  getMid,\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  delta\n} from 'diagram-js/lib/util/PositionUtil';\n\nimport {\n  sortBy\n} from 'min-dash';\n\nimport {\n  getDistancePointLine,\n  perpendicularFoot\n} from './util/GeometricUtil';\n\nvar DEFAULT_LABEL_DIMENSIONS = {\n  width: 90,\n  height: 20\n};\n\nvar NAME_PROPERTY = 'name';\nvar TEXT_PROPERTY = 'text';\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnFactory} bpmnFactory\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelBehavior(\n    eventBus, modeling, bpmnFactory,\n    textRenderer) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // update label if name property was updated\n  this.postExecute('element.updateProperties', function(e) {\n    var context = e.context,\n        element = context.element,\n        properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n\n    if (TEXT_PROPERTY in properties\n        && is(element, 'bpmn:TextAnnotation')) {\n\n      var newBounds = textRenderer.getTextAnnotationBounds(\n        {\n          x: element.x,\n          y: element.y,\n          width: element.width,\n          height: element.height\n        },\n        properties[TEXT_PROPERTY] || ''\n      );\n\n      modeling.updateLabel(element, properties.text, newBounds);\n    }\n  });\n\n  // create label shape after shape/connection was created\n  this.postExecute([ 'shape.create', 'connection.create' ], function(e) {\n    var context = e.context,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    var element = context.shape || context.connection,\n        businessObject = element.businessObject;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    }\n\n    // only create label if attribute available\n    if (!getLabel(element)) {\n      return;\n    }\n\n    var labelCenter = getExternalLabelMid(element);\n\n    // we don't care about x and y\n    var labelDimensions = textRenderer.getExternalLabelBounds(\n      DEFAULT_LABEL_DIMENSIONS,\n      getLabel(element)\n    );\n\n    modeling.createLabel(element, labelCenter, {\n      id: businessObject.id + '_label',\n      businessObject: businessObject,\n      width: labelDimensions.width,\n      height: labelDimensions.height\n    });\n  });\n\n  // update label after label shape was deleted\n  this.postExecute('shape.delete', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget,\n        hints = context.hints || {};\n\n    // check if label\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, { removeShape: false });\n    }\n  });\n\n  // update di information on label creation\n  this.postExecute([ 'label.create' ], function(event) {\n\n    var context = event.context,\n        element = context.shape,\n        labelTarget = context.labelTarget,\n        di;\n\n    // we want to trigger on real labels only\n    if (!labelTarget) {\n      return;\n    }\n\n    // we want to trigger on BPMN elements only\n    if (!is(labelTarget, 'bpmn:BaseElement')) {\n      return;\n    }\n\n    di = getDi(labelTarget);\n\n    if (!di.label) {\n      di.label = bpmnFactory.create('bpmndi:BPMNLabel', {\n        bounds: bpmnFactory.create('dc:Bounds')\n      });\n\n      element.di = di;\n    }\n\n    assign(di.label.bounds, {\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    });\n  });\n\n  function getVisibleLabelAdjustment(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        label = connection.label,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        hints = context.hints || {};\n\n    if (hints.labelBehavior === false) {\n      return;\n    }\n\n    var connection = context.connection,\n        label = connection.label,\n        labelAdjustment;\n\n    // handle missing label as well as the case\n    // that the label parent does not exist (yet),\n    // because it is being pasted / created via multi element create\n    //\n    // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n    if (!label || !label.parent) {\n      return;\n    }\n\n    labelAdjustment = getVisibleLabelAdjustment(event);\n\n    modeling.moveShape(label, labelAdjustment);\n  });\n\n\n  // keep label position on shape replace\n  this.postExecute([ 'shape.replace' ], function(event) {\n    var context = event.context,\n        newShape = context.newShape,\n        oldShape = context.oldShape;\n\n    var businessObject = getBusinessObject(newShape);\n\n    if (businessObject\n      && isLabelExternal(businessObject)\n      && oldShape.label\n      && newShape.label) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  });\n\n\n  // move external label after resizing\n  this.postExecute('shape.resize', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        newBounds = context.newBounds,\n        oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n\n      var label = shape.label,\n          labelMid = getMid(label),\n          edges = asEdges(oldBounds);\n\n      // get nearest border point to label as reference point\n      var referencePoint = getReferencePoint(labelMid, edges);\n\n      var delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n\n      modeling.moveShape(label, delta);\n\n    }\n\n  });\n\n}\n\ninherits(LabelBehavior, CommandInterceptor);\n\nLabelBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnFactory',\n  'textRenderer'\n];\n\n// helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} point\n * @param {Bounds} oldBounds\n * @param {Bounds} newBounds\n *\n * @return {Delta} delta\n */\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n\n  var newReferencePoint = getNewAttachPoint(referencePoint, oldBounds, newBounds);\n\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Array<Point, Point>} lines\n * @param {Point} point\n *\n * @param {Point}\n */\nexport function getReferencePoint(point, lines) {\n\n  if (!lines.length) {\n    return;\n  }\n\n  var nearestLine = getNearestLine(point, lines);\n\n  return perpendicularFoot(point, nearestLine);\n}\n\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Bounds|Point} bounds\n *\n * @return Array<Point>\n */\nexport function asEdges(bounds) {\n  return [\n    [ // top\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      }\n    ],\n    [ // right\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // bottom\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // left\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      }\n    ]\n  ];\n}\n\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param Array<Point> lines\n *\n * @return Array<Point>\n */\nfunction getNearestLine(point, lines) {\n\n  var distances = lines.map(function(l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l)\n    };\n  });\n\n  var sorted = sortBy(distances, 'distance');\n\n  return sorted[0].line;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
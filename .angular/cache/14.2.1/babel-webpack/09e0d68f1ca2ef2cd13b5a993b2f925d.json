{"ast":null,"code":"import SnapContext from './SnapContext';\nimport { bottomRight, getChildren, isSnapped, setSnapped, topLeft } from './SnapUtil';\nimport { isCmd } from '../keyboard/KeyboardUtil';\nimport { asTRBL, getMid } from '../../layout/LayoutUtil';\nimport { forEach } from 'min-dash';\nvar HIGHER_PRIORITY = 1250;\n/**\r\n * Snap during resize.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\n\nexport default function ResizeSnapping(eventBus, snapping) {\n  var self = this;\n  eventBus.on(['resize.start'], function (event) {\n    self.initSnap(event);\n  });\n  eventBus.on(['resize.move', 'resize.end'], HIGHER_PRIORITY, function (event) {\n    var context = event.context,\n        shape = context.shape,\n        parent = shape.parent,\n        direction = context.direction,\n        snapContext = context.snapContext;\n\n    if (event.originalEvent && isCmd(event.originalEvent)) {\n      return;\n    }\n\n    if (isSnapped(event)) {\n      return;\n    }\n\n    var snapPoints = snapContext.pointsForTarget(parent);\n\n    if (!snapPoints.initialized) {\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, parent, direction);\n      snapPoints.initialized = true;\n    }\n\n    if (isHorizontal(direction)) {\n      setSnapped(event, 'x', event.x);\n    }\n\n    if (isVertical(direction)) {\n      setSnapped(event, 'y', event.y);\n    }\n\n    snapping.snap(event, snapPoints);\n  });\n  eventBus.on(['resize.cleanup'], function () {\n    snapping.hide();\n  });\n}\n\nResizeSnapping.prototype.initSnap = function (event) {\n  var context = event.context,\n      shape = context.shape,\n      direction = context.direction,\n      snapContext = context.snapContext;\n\n  if (!snapContext) {\n    snapContext = context.snapContext = new SnapContext();\n  }\n\n  var snapOrigin = getSnapOrigin(shape, direction);\n  snapContext.setSnapOrigin('corner', {\n    x: snapOrigin.x - event.x,\n    y: snapOrigin.y - event.y\n  });\n  return snapContext;\n};\n\nResizeSnapping.prototype.addSnapTargetPoints = function (snapPoints, shape, target, direction) {\n  var snapTargets = this.getSnapTargets(shape, target);\n  forEach(snapTargets, function (snapTarget) {\n    snapPoints.add('corner', bottomRight(snapTarget));\n    snapPoints.add('corner', topLeft(snapTarget));\n  });\n  snapPoints.add('corner', getSnapOrigin(shape, direction));\n  return snapPoints;\n};\n\nResizeSnapping.$inject = ['eventBus', 'snapping'];\n\nResizeSnapping.prototype.getSnapTargets = function (shape, target) {\n  return getChildren(target).filter(function (child) {\n    return !isAttached(child, shape) && !isConnection(child) && !isHidden(child) && !isLabel(child);\n  });\n}; // helpers //////////\n\n\nfunction getSnapOrigin(shape, direction) {\n  var mid = getMid(shape),\n      trbl = asTRBL(shape);\n  var snapOrigin = {\n    x: mid.x,\n    y: mid.y\n  };\n\n  if (direction.indexOf('n') !== -1) {\n    snapOrigin.y = trbl.top;\n  } else if (direction.indexOf('s') !== -1) {\n    snapOrigin.y = trbl.bottom;\n  }\n\n  if (direction.indexOf('e') !== -1) {\n    snapOrigin.x = trbl.right;\n  } else if (direction.indexOf('w') !== -1) {\n    snapOrigin.x = trbl.left;\n  }\n\n  return snapOrigin;\n}\n\nfunction isAttached(element, host) {\n  return element.host === host;\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction isHidden(element) {\n  return !!element.hidden;\n}\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n\nfunction isHorizontal(direction) {\n  return direction === 'n' || direction === 's';\n}\n\nfunction isVertical(direction) {\n  return direction === 'e' || direction === 'w';\n}","map":{"version":3,"names":["SnapContext","bottomRight","getChildren","isSnapped","setSnapped","topLeft","isCmd","asTRBL","getMid","forEach","HIGHER_PRIORITY","ResizeSnapping","eventBus","snapping","self","on","event","initSnap","context","shape","parent","direction","snapContext","originalEvent","snapPoints","pointsForTarget","initialized","addSnapTargetPoints","isHorizontal","x","isVertical","y","snap","hide","prototype","snapOrigin","getSnapOrigin","setSnapOrigin","target","snapTargets","getSnapTargets","snapTarget","add","$inject","filter","child","isAttached","isConnection","isHidden","isLabel","mid","trbl","indexOf","top","bottom","right","left","element","host","waypoints","hidden","labelTarget"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/snapping/ResizeSnapping.js"],"sourcesContent":["import SnapContext from './SnapContext';\r\n\r\nimport {\r\n  bottomRight,\r\n  getChildren,\r\n  isSnapped,\r\n  setSnapped,\r\n  topLeft,\r\n} from './SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\n\r\n/**\r\n * Snap during resize.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\r\nexport default function ResizeSnapping(eventBus, snapping) {\r\n  var self = this;\r\n\r\n  eventBus.on([ 'resize.start' ], function(event) {\r\n    self.initSnap(event);\r\n  });\r\n\r\n  eventBus.on([\r\n    'resize.move',\r\n    'resize.end',\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        parent = shape.parent,\r\n        direction = context.direction,\r\n        snapContext = context.snapContext;\r\n\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (isSnapped(event)) {\r\n      return;\r\n    }\r\n\r\n    var snapPoints = snapContext.pointsForTarget(parent);\r\n\r\n    if (!snapPoints.initialized) {\r\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, parent, direction);\r\n\r\n      snapPoints.initialized = true;\r\n    }\r\n\r\n    if (isHorizontal(direction)) {\r\n      setSnapped(event, 'x', event.x);\r\n    }\r\n\r\n    if (isVertical(direction)) {\r\n      setSnapped(event, 'y', event.y);\r\n    }\r\n\r\n    snapping.snap(event, snapPoints);\r\n  });\r\n\r\n  eventBus.on([ 'resize.cleanup' ], function() {\r\n    snapping.hide();\r\n  });\r\n}\r\n\r\nResizeSnapping.prototype.initSnap = function(event) {\r\n  var context = event.context,\r\n      shape = context.shape,\r\n      direction = context.direction,\r\n      snapContext = context.snapContext;\r\n\r\n  if (!snapContext) {\r\n    snapContext = context.snapContext = new SnapContext();\r\n  }\r\n\r\n  var snapOrigin = getSnapOrigin(shape, direction);\r\n\r\n  snapContext.setSnapOrigin('corner', {\r\n    x: snapOrigin.x - event.x,\r\n    y: snapOrigin.y - event.y\r\n  });\r\n\r\n  return snapContext;\r\n};\r\n\r\nResizeSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target, direction) {\r\n  var snapTargets = this.getSnapTargets(shape, target);\r\n\r\n  forEach(snapTargets, function(snapTarget) {\r\n    snapPoints.add('corner', bottomRight(snapTarget));\r\n    snapPoints.add('corner', topLeft(snapTarget));\r\n  });\r\n\r\n  snapPoints.add('corner', getSnapOrigin(shape, direction));\r\n\r\n  return snapPoints;\r\n};\r\n\r\nResizeSnapping.$inject = [\r\n  'eventBus',\r\n  'snapping'\r\n];\r\n\r\nResizeSnapping.prototype.getSnapTargets = function(shape, target) {\r\n  return getChildren(target).filter(function(child) {\r\n    return !isAttached(child, shape)\r\n      && !isConnection(child)\r\n      && !isHidden(child)\r\n      && !isLabel(child);\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction getSnapOrigin(shape, direction) {\r\n  var mid = getMid(shape),\r\n      trbl = asTRBL(shape);\r\n\r\n  var snapOrigin = {\r\n    x: mid.x,\r\n    y: mid.y\r\n  };\r\n\r\n  if (direction.indexOf('n') !== -1) {\r\n    snapOrigin.y = trbl.top;\r\n  } else if (direction.indexOf('s') !== -1) {\r\n    snapOrigin.y = trbl.bottom;\r\n  }\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    snapOrigin.x = trbl.right;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    snapOrigin.x = trbl.left;\r\n  }\r\n\r\n  return snapOrigin;\r\n}\r\n\r\nfunction isAttached(element, host) {\r\n  return element.host === host;\r\n}\r\n\r\nfunction isConnection(element) {\r\n  return !!element.waypoints;\r\n}\r\n\r\nfunction isHidden(element) {\r\n  return !!element.hidden;\r\n}\r\n\r\nfunction isLabel(element) {\r\n  return !!element.labelTarget;\r\n}\r\n\r\nfunction isHorizontal(direction) {\r\n  return direction === 'n' || direction === 's';\r\n}\r\n\r\nfunction isVertical(direction) {\r\n  return direction === 'e' || direction === 'w';\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
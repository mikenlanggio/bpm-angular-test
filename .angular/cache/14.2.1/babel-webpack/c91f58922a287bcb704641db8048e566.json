{"ast":null,"code":"import { append as svgAppend, attr as svgAttr, create as svgCreate, remove as svgRemove } from 'tiny-svg';\nimport { getDi, is } from '../../util/ModelUtil';\nimport { translate } from 'diagram-js/lib/util/SvgTransformUtil';\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\nexport default function LabelEditingPreview(eventBus, canvas, elementRegistry, pathMap) {\n  var self = this;\n  var defaultLayer = canvas.getDefaultLayer();\n  var element, absoluteElementBBox, gfx;\n  eventBus.on('directEditing.activate', function (context) {\n    var activeProvider = context.active;\n    element = activeProvider.element.label || activeProvider.element; // text annotation\n\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n      gfx = svgCreate('g');\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n      var path = self.path = svgCreate('path');\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n      svgAppend(gfx, path);\n      svgAppend(defaultLayer, gfx);\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, 'bpmn:TextAnnotation') || element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') || is(element, 'bpmn:CallActivity') || is(element, 'bpmn:SubProcess') || is(element, 'bpmn:Participant')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n  eventBus.on('directEditing.resize', function (context) {\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n          dy = context.dy;\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n  eventBus.on(['directEditing.complete', 'directEditing.cancel'], function (context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n      gfx = undefined;\n    }\n  });\n}\nLabelEditingPreview.$inject = ['eventBus', 'canvas', 'elementRegistry', 'pathMap']; // helpers ///////////////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n  return di.get('stroke') || defaultColor || 'black';\n}","map":{"version":3,"names":["append","svgAppend","attr","svgAttr","create","svgCreate","remove","svgRemove","getDi","is","translate","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","eventBus","canvas","elementRegistry","pathMap","self","defaultLayer","getDefaultLayer","element","absoluteElementBBox","gfx","on","context","activeProvider","active","label","getAbsoluteBBox","textPathData","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","width","containerHeight","height","position","mx","my","path","d","strokeWidth","stroke","getStrokeColor","x","y","labelTarget","addMarker","dy","newElementHeight","Math","max","removeMarker","undefined","$inject","defaultColor","di","get"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/label-editing/LabelEditingPreview.js"],"sourcesContent":["import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n\nexport default function LabelEditingPreview(\n    eventBus, canvas, elementRegistry,\n    pathMap) {\n\n  var self = this;\n\n  var defaultLayer = canvas.getDefaultLayer();\n\n  var element, absoluteElementBBox, gfx;\n\n  eventBus.on('directEditing.activate', function(context) {\n    var activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n\n      gfx = svgCreate('g');\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      var path = self.path = svgCreate('path');\n\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n\n      svgAppend(gfx, path);\n\n      svgAppend(defaultLayer, gfx);\n\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, 'bpmn:TextAnnotation') ||\n        element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') ||\n               is(element, 'bpmn:CallActivity') ||\n               is(element, 'bpmn:SubProcess') ||\n               is(element, 'bpmn:Participant')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n  eventBus.on('directEditing.resize', function(context) {\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n          dy = context.dy;\n\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n\n  eventBus.on([ 'directEditing.complete', 'directEditing.cancel' ], function(context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  'eventBus',\n  'canvas',\n  'elementRegistry',\n  'pathMap'\n];\n\n\n// helpers ///////////////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n\n  return di.get('stroke') || defaultColor || 'black';\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}
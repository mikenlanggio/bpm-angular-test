{"ast":null,"code":"import { forEach, filter } from 'min-dash';\nimport inherits from 'inherits-browser';\nvar LOW_PRIORITY = 250,\n    HIGH_PRIORITY = 1400;\nimport { add as collectionAdd, indexOf as collectionIdx } from '../../util/Collections';\nimport { saveClear } from '../../util/Removal';\nimport CommandInterceptor from '../../command/CommandInterceptor';\n/**\n * A handler that makes sure labels are properly moved with\n * their label targets.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\n\nexport default function LabelSupport(injector, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  var movePreview = injector.get('movePreview', false); // remove labels from the collection that are being\n  // moved with other elements anyway\n\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function (e) {\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n    context.shapes = removeLabels(shapes);\n    context.validatedShapes = removeLabels(validatedShapes);\n  }); // add labels to visual's group\n\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function (e) {\n    var context = e.context,\n        shapes = context.shapes;\n    var labels = [];\n    forEach(shapes, function (element) {\n      forEach(element.labels, function (label) {\n        if (!label.hidden && context.shapes.indexOf(label) === -1) {\n          labels.push(label);\n        }\n\n        if (element.labelTarget) {\n          labels.push(element);\n        }\n      });\n    });\n    forEach(labels, function (label) {\n      movePreview.makeDraggable(context, label, true);\n    });\n  }); // add all labels to move closure\n\n  this.preExecuted('elements.move', HIGH_PRIORITY, function (e) {\n    var context = e.context,\n        closure = context.closure,\n        enclosedElements = closure.enclosedElements;\n    var enclosedLabels = []; // find labels that are not part of\n    // move closure yet and add them\n\n    forEach(enclosedElements, function (element) {\n      forEach(element.labels, function (label) {\n        if (!enclosedElements[label.id]) {\n          enclosedLabels.push(label);\n        }\n      });\n    });\n    closure.addAll(enclosedLabels);\n  });\n  this.preExecute(['connection.delete', 'shape.delete'], function (e) {\n    var context = e.context,\n        element = context.connection || context.shape;\n    saveClear(element.labels, function (label) {\n      modeling.removeShape(label, {\n        nested: true\n      });\n    });\n  });\n  this.execute('shape.delete', function (e) {\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = shape.labelTarget; // unset labelTarget\n\n    if (labelTarget) {\n      context.labelTargetIndex = collectionIdx(labelTarget.labels, shape);\n      context.labelTarget = labelTarget;\n      shape.labelTarget = null;\n    }\n  });\n  this.revert('shape.delete', function (e) {\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = context.labelTarget,\n        labelTargetIndex = context.labelTargetIndex; // restore labelTarget\n\n    if (labelTarget) {\n      collectionAdd(labelTarget.labels, shape, labelTargetIndex);\n      shape.labelTarget = labelTarget;\n    }\n  });\n}\ninherits(LabelSupport, CommandInterceptor);\nLabelSupport.$inject = ['injector', 'eventBus', 'modeling'];\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param  {Array<djs.model.Base>} elements\n *\n * @return {Array<djs.model.Base>} filtered\n */\n\nfunction removeLabels(elements) {\n  return filter(elements, function (element) {\n    // filter out labels that are move together\n    // with their label targets\n    return elements.indexOf(element.labelTarget) === -1;\n  });\n}","map":{"version":3,"names":["forEach","filter","inherits","LOW_PRIORITY","HIGH_PRIORITY","add","collectionAdd","indexOf","collectionIdx","saveClear","CommandInterceptor","LabelSupport","injector","eventBus","modeling","call","movePreview","get","on","e","context","shapes","validatedShapes","removeLabels","labels","element","label","hidden","push","labelTarget","makeDraggable","preExecuted","closure","enclosedElements","enclosedLabels","id","addAll","preExecute","connection","shape","removeShape","nested","execute","labelTargetIndex","revert","$inject","elements"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/diagram-js/lib/features/label-support/LabelSupport.js"],"sourcesContent":["import {\n  forEach,\n  filter\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nvar LOW_PRIORITY = 250,\n    HIGH_PRIORITY = 1400;\n\nimport {\n  add as collectionAdd,\n  indexOf as collectionIdx\n} from '../../util/Collections';\n\nimport { saveClear } from '../../util/Removal';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n\n/**\n * A handler that makes sure labels are properly moved with\n * their label targets.\n *\n * @param {didi.Injector} injector\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function LabelSupport(injector, eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var movePreview = injector.get('movePreview', false);\n\n  // remove labels from the collection that are being\n  // moved with other elements anyway\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n\n    context.shapes = removeLabels(shapes);\n    context.validatedShapes = removeLabels(validatedShapes);\n  });\n\n  // add labels to visual's group\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes;\n\n    var labels = [];\n\n    forEach(shapes, function(element) {\n\n      forEach(element.labels, function(label) {\n\n        if (!label.hidden && context.shapes.indexOf(label) === -1) {\n          labels.push(label);\n        }\n\n        if (element.labelTarget) {\n          labels.push(element);\n        }\n      });\n    });\n\n    forEach(labels, function(label) {\n      movePreview.makeDraggable(context, label, true);\n    });\n\n  });\n\n  // add all labels to move closure\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\n    var context = e.context,\n        closure = context.closure,\n        enclosedElements = closure.enclosedElements;\n\n    var enclosedLabels = [];\n\n    // find labels that are not part of\n    // move closure yet and add them\n    forEach(enclosedElements, function(element) {\n      forEach(element.labels, function(label) {\n\n        if (!enclosedElements[label.id]) {\n          enclosedLabels.push(label);\n        }\n      });\n    });\n\n    closure.addAll(enclosedLabels);\n  });\n\n\n  this.preExecute([\n    'connection.delete',\n    'shape.delete'\n  ], function(e) {\n\n    var context = e.context,\n        element = context.connection || context.shape;\n\n    saveClear(element.labels, function(label) {\n      modeling.removeShape(label, { nested: true });\n    });\n  });\n\n\n  this.execute('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = shape.labelTarget;\n\n    // unset labelTarget\n    if (labelTarget) {\n      context.labelTargetIndex = collectionIdx(labelTarget.labels, shape);\n      context.labelTarget = labelTarget;\n\n      shape.labelTarget = null;\n    }\n  });\n\n  this.revert('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = context.labelTarget,\n        labelTargetIndex = context.labelTargetIndex;\n\n    // restore labelTarget\n    if (labelTarget) {\n      collectionAdd(labelTarget.labels, shape, labelTargetIndex);\n\n      shape.labelTarget = labelTarget;\n    }\n  });\n\n}\n\ninherits(LabelSupport, CommandInterceptor);\n\nLabelSupport.$inject = [\n  'injector',\n  'eventBus',\n  'modeling'\n];\n\n\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param  {Array<djs.model.Base>} elements\n *\n * @return {Array<djs.model.Base>} filtered\n */\nfunction removeLabels(elements) {\n\n  return filter(elements, function(element) {\n\n    // filter out labels that are move together\n    // with their label targets\n    return elements.indexOf(element.labelTarget) === -1;\n  });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
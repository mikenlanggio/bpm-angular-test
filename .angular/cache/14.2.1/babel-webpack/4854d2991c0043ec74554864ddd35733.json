{"ast":null,"code":"import { is } from '../../util/ModelUtil';\n/**\n * Move collapsed subprocesses into view when drilling down.\n *\n * Zoom and scroll are saved in a session.\n *\n * @param {eventBus} eventBus\n * @param {canvas} canvas\n */\n\nexport default function DrilldownCentering(eventBus, canvas) {\n  var currentRoot = null;\n  var positionMap = new Map();\n  eventBus.on('root.set', function (event) {\n    var newRoot = event.element;\n    var currentViewbox = canvas.viewbox();\n    var storedViewbox = positionMap.get(newRoot);\n    positionMap.set(currentRoot, {\n      x: currentViewbox.x,\n      y: currentViewbox.y,\n      zoom: currentViewbox.scale\n    });\n    currentRoot = newRoot; // current root was replaced with a collaboration, we don't update the viewbox\n\n    if (is(newRoot, 'bpmn:Collaboration') && !storedViewbox) {\n      return;\n    }\n\n    storedViewbox = storedViewbox || {\n      x: 0,\n      y: 0,\n      zoom: 1\n    };\n    var dx = (currentViewbox.x - storedViewbox.x) * currentViewbox.scale,\n        dy = (currentViewbox.y - storedViewbox.y) * currentViewbox.scale;\n\n    if (dx !== 0 || dy !== 0) {\n      canvas.scroll({\n        dx: dx,\n        dy: dy\n      });\n    }\n\n    if (storedViewbox.zoom !== currentViewbox.scale) {\n      canvas.zoom(storedViewbox.zoom, {\n        x: 0,\n        y: 0\n      });\n    }\n  });\n  eventBus.on('diagram.clear', function () {\n    positionMap.clear();\n    currentRoot = null;\n  });\n}\nDrilldownCentering.$inject = ['eventBus', 'canvas'];\n/**\n * ES5 Map implementation. Works.\n */\n\nfunction Map() {\n  this._entries = [];\n\n  this.set = function (key, value) {\n    var found = false;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        this._entries[k][1] = value;\n        found = true;\n        break;\n      }\n    }\n\n    if (!found) {\n      this._entries.push([key, value]);\n    }\n  };\n\n  this.get = function (key) {\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        return this._entries[k][1];\n      }\n    }\n\n    return null;\n  };\n\n  this.clear = function () {\n    this._entries.length = 0;\n  };\n\n  this.remove = function (key) {\n    var idx = -1;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        idx = k;\n        break;\n      }\n    }\n\n    if (idx !== -1) {\n      this._entries.splice(idx, 1);\n    }\n  };\n}","map":{"version":3,"names":["is","DrilldownCentering","eventBus","canvas","currentRoot","positionMap","Map","on","event","newRoot","element","currentViewbox","viewbox","storedViewbox","get","set","x","y","zoom","scale","dx","dy","scroll","clear","$inject","_entries","key","value","found","k","push","length","remove","idx","splice"],"sources":["E:/Old_PC/Study/Angular/test-bpm/node_modules/bpmn-js/lib/features/drilldown/DrilldownCentering.js"],"sourcesContent":["import { is } from '../../util/ModelUtil';\n\n/**\n * Move collapsed subprocesses into view when drilling down.\n *\n * Zoom and scroll are saved in a session.\n *\n * @param {eventBus} eventBus\n * @param {canvas} canvas\n */\nexport default function DrilldownCentering(eventBus, canvas) {\n\n  var currentRoot = null;\n  var positionMap = new Map();\n\n  eventBus.on('root.set', function(event) {\n    var newRoot = event.element;\n    var currentViewbox = canvas.viewbox();\n    var storedViewbox = positionMap.get(newRoot);\n\n    positionMap.set(currentRoot, {\n      x: currentViewbox.x,\n      y: currentViewbox.y,\n      zoom: currentViewbox.scale\n    });\n\n    currentRoot = newRoot;\n\n    // current root was replaced with a collaboration, we don't update the viewbox\n    if (is(newRoot, 'bpmn:Collaboration') && !storedViewbox) {\n      return;\n    }\n\n    storedViewbox = storedViewbox || { x: 0, y: 0, zoom: 1 };\n\n    var dx = (currentViewbox.x - storedViewbox.x) * currentViewbox.scale,\n        dy = (currentViewbox.y - storedViewbox.y) * currentViewbox.scale;\n\n    if (dx !== 0 || dy !== 0) {\n      canvas.scroll({\n        dx: dx,\n        dy: dy\n      });\n    }\n\n    if (storedViewbox.zoom !== currentViewbox.scale) {\n      canvas.zoom(storedViewbox.zoom, { x: 0, y: 0 });\n    }\n  });\n\n  eventBus.on('diagram.clear', function() {\n    positionMap.clear();\n    currentRoot = null;\n  });\n\n}\n\nDrilldownCentering.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * ES5 Map implementation. Works.\n */\nfunction Map() {\n\n  this._entries = [];\n\n  this.set = function(key, value) {\n\n    var found = false;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        this._entries[k][1] = value;\n\n        found = true;\n\n        break;\n      }\n    }\n\n    if (!found) {\n      this._entries.push([ key, value ]);\n    }\n  };\n\n  this.get = function(key) {\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        return this._entries[k][1];\n      }\n    }\n\n    return null;\n  };\n\n  this.clear = function() {\n    this._entries.length = 0;\n  };\n\n  this.remove = function(key) {\n\n    var idx = -1;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        idx = k;\n\n        break;\n      }\n    }\n\n    if (idx !== -1) {\n      this._entries.splice(idx, 1);\n    }\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}